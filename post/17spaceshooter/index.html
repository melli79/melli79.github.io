<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>17. Weltraum-Shooter - Melchior&#39;s Homepage</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="melli79" /><meta name="description" content="Nachdem wir letztens Wirbel im Computer animiert haben, wollen wir heute ein kleines animiertes Spiel produzieren.
Das Ziel Warnung! Computerspiele lenken vom realen Leben ab. Das kann zur Vernachlässigung der realen Beziehungen, der Gesundheit führen, und kann die Entwicklung von Kindern und Jugendlichen beeinträchtigen und gefährden. Seid verantwortlich und begrenzt die Zeit für Computer- und Handy-Spiele.
Warnung! Waffen und Kriege können verletzen und Menschen töten. Wenn diese Teil fiktionaler Spiele sind, heißt das nicht, dass sie harmlos wären." />






<meta name="generator" content="Hugo 0.120.2 with theme even" />


<link rel="canonical" href="https://melli79.github.io/post/17spaceshooter/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.78d3a03abaed5d3c468bdf402fc110f36c046abf091a63421b9ce0a5a63db941.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="17. Weltraum-Shooter" />
<meta property="og:description" content="Nachdem wir letztens Wirbel im Computer animiert haben, wollen wir heute ein kleines animiertes Spiel produzieren.
Das Ziel Warnung! Computerspiele lenken vom realen Leben ab. Das kann zur Vernachlässigung der realen Beziehungen, der Gesundheit führen, und kann die Entwicklung von Kindern und Jugendlichen beeinträchtigen und gefährden. Seid verantwortlich und begrenzt die Zeit für Computer- und Handy-Spiele.
Warnung! Waffen und Kriege können verletzen und Menschen töten. Wenn diese Teil fiktionaler Spiele sind, heißt das nicht, dass sie harmlos wären." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://melli79.github.io/post/17spaceshooter/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-10-31T19:20:50+01:00" />
<meta property="article:modified_time" content="2023-10-31T19:20:50+01:00" />

<meta itemprop="name" content="17. Weltraum-Shooter">
<meta itemprop="description" content="Nachdem wir letztens Wirbel im Computer animiert haben, wollen wir heute ein kleines animiertes Spiel produzieren.
Das Ziel Warnung! Computerspiele lenken vom realen Leben ab. Das kann zur Vernachlässigung der realen Beziehungen, der Gesundheit führen, und kann die Entwicklung von Kindern und Jugendlichen beeinträchtigen und gefährden. Seid verantwortlich und begrenzt die Zeit für Computer- und Handy-Spiele.
Warnung! Waffen und Kriege können verletzen und Menschen töten. Wenn diese Teil fiktionaler Spiele sind, heißt das nicht, dass sie harmlos wären."><meta itemprop="datePublished" content="2023-10-31T19:20:50+01:00" />
<meta itemprop="dateModified" content="2023-10-31T19:20:50+01:00" />
<meta itemprop="wordCount" content="2543">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="17. Weltraum-Shooter"/>
<meta name="twitter:description" content="Nachdem wir letztens Wirbel im Computer animiert haben, wollen wir heute ein kleines animiertes Spiel produzieren.
Das Ziel Warnung! Computerspiele lenken vom realen Leben ab. Das kann zur Vernachlässigung der realen Beziehungen, der Gesundheit führen, und kann die Entwicklung von Kindern und Jugendlichen beeinträchtigen und gefährden. Seid verantwortlich und begrenzt die Zeit für Computer- und Handy-Spiele.
Warnung! Waffen und Kriege können verletzen und Menschen töten. Wenn diese Teil fiktionaler Spiele sind, heißt das nicht, dass sie harmlos wären."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Melchior&#39;s Homepage</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archiv</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Schlagworte</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Melchior&#39;s Homepage</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archiv</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Schlagworte</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">17. Weltraum-Shooter</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-10-31 </span>
        <div class="post-category">
            <a href="/categories/kotlin/"> Kotlin </a>
            <a href="/categories/programming/"> Programming </a>
            <a href="/categories/gui/"> GUI </a>
            <a href="/categories/game/"> Game </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#das-ziel">Das Ziel</a></li>
    <li><a href="#0-programm-aufsetzen">0. Programm aufsetzen</a>
      <ul>
        <li><a href="#1-der-shooter">1 Der Shooter</a></li>
      </ul>
    </li>
    <li><a href="#3-dynamische-komponenten">3. Dynamische Komponenten</a>
      <ul>
        <li><a href="#31-felsen">3.1 Felsen</a></li>
        <li><a href="#32-bewegliches-flugzeug">3.2 Bewegliches Flugzeug</a></li>
        <li><a href="#33-schießen">3.3 Schießen</a></li>
        <li><a href="#34-explosionen">3.4 Explosionen</a></li>
        <li><a href="#35-dropping-bombs">3.5 Dropping Bombs</a></li>
      </ul>
    </li>
    <li><a href="#4-noch-etwas-polieren">4. Noch etwas Polieren</a>
      <ul>
        <li><a href="#41-felsen-replizieren">4.1 Felsen Replizieren</a></li>
      </ul>
    </li>
    <li><a href="#9-selbst-probieren">9. Selbst Probieren</a>
      <ul>
        <li><a href="#91-ein-weiteres-level">9.1 Ein weiteres Level</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Nachdem wir letztens Wirbel im Computer animiert haben, wollen wir heute ein kleines animiertes Spiel produzieren.</p>
<h1 id="das-ziel">Das Ziel</h1>
<p><strong>Warnung!</strong> Computerspiele lenken vom realen Leben ab.  Das kann zur Vernachlässigung der realen Beziehungen, der Gesundheit führen, und kann die Entwicklung von Kindern und Jugendlichen beeinträchtigen und gefährden.  Seid verantwortlich und begrenzt die Zeit für Computer- und Handy-Spiele.</p>
<p><strong>Warnung!</strong> Waffen und Kriege können verletzen und Menschen töten.  Wenn diese Teil fiktionaler Spiele sind, heißt das nicht, dass sie harmlos wären.  Beim Umgang mit Waffen sollten immer Vorsicht walten, und sie gehören nicht in die Hände von Kindern, Jugendlichen oder psychologisch labilen Menschen.</p>
<center>
<video width="320" height="240" controls autoplay="true" loop>
  <source src="/movies/spaceShooter.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
</center>
<h1 id="0-programm-aufsetzen">0. Programm aufsetzen</h1>
<p>So wie bei den meisten Desktop Grafik-Apps, starten wir mit einem Hauptprogramm,
dass ein Fenster anlegt, in dem dann unsere Komponente dargestellt wird.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">abstract</span> <span class="k">class</span> <span class="nc">GameComponent</span> <span class="p">:</span><span class="n">JComponent</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">accelerateLeft</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">accelerateRight</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">shoot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">MyWindow</span><span class="p">(</span><span class="k">private</span> <span class="k">val</span> <span class="py">content</span> <span class="p">:</span><span class="n">JComponent</span><span class="p">)</span> <span class="p">:</span><span class="n">JFrame</span><span class="p">(</span><span class="s2">&#34;Space Shooter&#34;</span><span class="p">),</span> <span class="n">KeyListener</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">init</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">layout</span> <span class="p">=</span> <span class="n">BorderLayout</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">contentPane</span> <span class="p">=</span> <span class="n">content</span>
</span></span><span class="line"><span class="cl">      <span class="n">preferredSize</span> <span class="p">=</span> <span class="n">Dimension</span><span class="p">(</span><span class="m">600</span><span class="p">,</span> <span class="m">400</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">setSize</span><span class="p">(</span><span class="m">600</span><span class="p">,</span> <span class="m">400</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">defaultCloseOperation</span> <span class="p">=</span> <span class="n">EXIT_ON_CLOSE</span>
</span></span><span class="line"><span class="cl">      <span class="n">addKeyListener</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">keyPressed</span><span class="p">(</span><span class="n">event</span> <span class="p">:</span><span class="n">KeyEvent</span><span class="p">)</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">code</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nc">KeyEvent</span><span class="p">.</span><span class="n">VK_LEFT</span> <span class="o">-&gt;</span> <span class="n">content</span><span class="p">.</span><span class="n">accelerateLeft</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="nc">KeyEvent</span><span class="p">.</span><span class="n">VK_RIGHT</span> <span class="o">-&gt;</span> <span class="n">content</span><span class="p">.</span><span class="n">accelerateRight</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="nc">KeyEvent</span><span class="p">.</span><span class="n">VK_SPACE</span> <span class="o">-&gt;</span> <span class="n">content</span><span class="p">.</span><span class="n">shoot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="nc">KeyEvent</span><span class="p">.</span><span class="n">VK_BACKSPACE</span> <span class="o">-&gt;</span> <span class="n">content</span><span class="p">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="nc">KeyEvent</span><span class="p">.</span><span class="n">VK_ESCAPE</span> <span class="o">-&gt;</span> <span class="n">exitProcess</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span> <span class="o">-&gt;</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">keyReleased</span><span class="p">(</span><span class="n">event</span> <span class="p">:</span><span class="n">KeyEvent</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">keyTyped</span><span class="p">(</span><span class="n">event</span> <span class="p">:</span><span class="n">KeyEvent</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">window</span> <span class="p">=</span> <span class="n">MyWindow</span><span class="p">(</span><span class="n">SpaceShooter</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">window</span><span class="p">.</span><span class="n">isVisible</span> <span class="p">=</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Unser Fenster soll auf Tastatureingaben reagieren, deshalb registrieren wir <code>MyWindow</code> als <code>KeyListener</code>.  Dazu müssen wir 3 Methoden implementieren <code>keyTyped</code>, <code>keyPressed</code>, <code>keyReleased</code>.  Für unsere Zwecke reicht es, in der Funktion <code>keyPressed</code> etwas auszuführen, die anderen beiden Funktionen können also leer bleiben.</p>
<p>Damit wir nicht die <code>Shooter</code>-Komponente hart verdrahten, habe ich eine abstrakte Klasse <code>GameComponent</code> eingeführt.  Diese erfült 2 Zwecke.  Zum einen muss sie von <code>JComponent</code> erben, kann also kein reines <code>interface</code> sein.  Zum anderen definiert sie eine handvoll Methoden, die auf Tastaturereignisse reagieren.  Diese werden in der Methode <code>keyPressed</code> aufgerufen.  Zusätzlich haben wir da noch implementiert, dass man das Spiel mit &lt;ESC&gt; schnell beenden kann.</p>
<h2 id="1-der-shooter">1 Der Shooter</h2>
<p>Der eigentliche Dynamik geschieht in einer <code>GameComponent</code>, so wie wir das bisher mit einer <code>JComponent</code> gemacht haben:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">SpaceShooter</span><span class="p">()</span> <span class="p">:</span><span class="n">GameComponent</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">val</span> <span class="py">range</span> <span class="p">=</span> <span class="nc">Rect</span><span class="p">.</span><span class="n">of</span><span class="p">(-</span><span class="m">1.0</span><span class="p">,</span> <span class="m">0.0</span><span class="p">,</span> <span class="m">1.0</span><span class="p">,</span> <span class="m">1.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="k">private</span> <span class="k">lateinit</span> <span class="k">var</span> <span class="py">scale</span> <span class="p">:</span><span class="n">Rect</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="k">private</span> <span class="k">val</span> <span class="py">background</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="n">Point</span><span class="p">&gt;()</span>
</span></span><span class="line"><span class="cl">     <span class="k">private</span> <span class="k">val</span> <span class="py">shots</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="n">Shot</span><span class="p">&gt;()</span>
</span></span><span class="line"><span class="cl">     <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">     <span class="k">private</span> <span class="k">var</span> <span class="py">state</span> <span class="p">=</span> <span class="nc">State</span><span class="p">.</span><span class="n">CONTINUE</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="k">private</span> <span class="k">lateinit</span> <span class="k">var</span> <span class="py">shot</span> <span class="p">:</span><span class="n">Image</span>
</span></span><span class="line"><span class="cl">     <span class="k">private</span> <span class="k">lateinit</span> <span class="k">var</span> <span class="py">bomb</span> <span class="p">:</span><span class="n">Image</span>
</span></span><span class="line"><span class="cl">     <span class="k">private</span> <span class="k">lateinit</span> <span class="k">var</span> <span class="py">hero</span> <span class="p">:</span><span class="n">Image</span>
</span></span><span class="line"><span class="cl">     <span class="k">private</span> <span class="k">lateinit</span> <span class="k">var</span> <span class="py">rock</span> <span class="p">:</span><span class="n">Image</span>
</span></span><span class="line"><span class="cl">     <span class="k">private</span> <span class="k">lateinit</span> <span class="k">var</span> <span class="py">boom</span> <span class="p">:</span><span class="n">Image</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="k">init</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="n">loadSprites</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">       <span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="k">override</span> <span class="k">fun</span> <span class="nf">reset</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="n">state</span> <span class="p">=</span> <span class="nc">State</span><span class="p">.</span><span class="n">CONTINUE</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="k">override</span> <span class="k">fun</span> <span class="nf">paint</span><span class="p">(</span><span class="n">g</span> <span class="p">:</span><span class="n">Graphics</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="n">scale</span> <span class="p">=</span> <span class="n">computeScale</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="n">background</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="n">g</span><span class="p">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">rock</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="k">it</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="k">it</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">}</span>
</span></span><span class="line"><span class="cl">       <span class="k">for</span> <span class="p">(</span><span class="n">shot</span> <span class="k">in</span> <span class="n">shots</span><span class="p">.</span><span class="n">toList</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="n">g</span><span class="p">.</span><span class="n">drawImage</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">shot</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">shot</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">shot</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">       <span class="p">}</span>
</span></span><span class="line"><span class="cl">       <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="k">fun</span> <span class="nf">computeScale</span><span class="p">(</span><span class="n">width</span> <span class="p">:</span><span class="n">Int</span><span class="p">,</span> <span class="n">height</span> <span class="p">:</span><span class="n">Int</span><span class="p">)</span> <span class="p">:</span><span class="n">Rect</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="k">val</span> <span class="py">dx</span> <span class="p">=</span> <span class="n">width</span><span class="p">/</span><span class="n">range</span><span class="p">.</span><span class="n">dx</span>
</span></span><span class="line"><span class="cl">       <span class="k">val</span> <span class="py">dy</span> <span class="p">=</span> <span class="n">height</span><span class="p">/</span><span class="n">range</span><span class="p">.</span><span class="n">dy</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="n">Rect</span><span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">x0</span> <span class="p">+</span><span class="m">10</span><span class="p">/</span><span class="n">dx</span><span class="p">,</span> <span class="n">range</span><span class="p">.</span><span class="n">y1</span> <span class="p">+</span><span class="m">10</span><span class="p">/</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="p">-</span><span class="n">dy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="k">data</span> <span class="k">class</span> <span class="nc">Rect</span><span class="p">(</span><span class="k">val</span> <span class="py">x0</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="k">val</span> <span class="py">y0</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="k">val</span> <span class="py">dx</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="k">val</span> <span class="py">dy</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="k">fun</span> <span class="nf">of</span><span class="p">(</span><span class="n">x0</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="n">y0</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="n">x1</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="n">y1</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">            <span class="n">Rect</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">-</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">-</span><span class="n">y0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">}</span>
</span></span><span class="line"><span class="cl">       <span class="k">val</span> <span class="py">y1</span> <span class="p">:</span><span class="n">Double</span>
</span></span><span class="line"><span class="cl">         <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">y0</span><span class="p">+</span><span class="n">dy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="k">fun</span> <span class="nf">px</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">=</span> <span class="p">((</span><span class="n">x</span><span class="p">-</span><span class="n">x0</span><span class="p">)*</span><span class="n">dx</span><span class="p">).</span><span class="n">roundToInt</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">       <span class="k">fun</span> <span class="nf">py</span><span class="p">(</span><span class="n">y</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">=</span> <span class="p">((</span><span class="n">y</span><span class="p">-</span><span class="n">y0</span><span class="p">)*</span><span class="n">dy</span><span class="p">).</span><span class="n">roundToInt</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="3-dynamische-komponenten">3. Dynamische Komponenten</h1>
<h2 id="31-felsen">3.1 Felsen</h2>
<p>Der Hintergrund besteht aus einer handvoll Felsen, die durch Punkte gespeichert werden und sich nicht bewegen sollen.  Allerdings können die Felsen zerstört werden, sodass wir ihre Liste dynamisch machen <code>background = mutableListOf&lt;Point&gt;()</code>.  Woraus besteht nun ein Punkt?  Klar, x- und y-Koordinate, also</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">data</span> <span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="k">val</span> <span class="py">x</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="k">val</span> <span class="py">y</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">{}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Außerdem müssen wir am Anfang eine Hand voll Felsen anlegen, etwa so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">fillBackground</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">background</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">(-</span><span class="m">9.</span><span class="p">.</span><span class="m">9</span><span class="p">).</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">background</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="m">0.1</span><span class="p">*</span><span class="k">it</span><span class="p">,</span> <span class="m">0.9</span><span class="p">))</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">(-</span><span class="m">5.</span><span class="p">.&lt;</span> <span class="m">5</span><span class="p">).</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">background</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="m">0.2</span><span class="p">*</span><span class="k">it</span><span class="p">+</span><span class="m">0.1</span><span class="p">,</span> <span class="m">0.8</span><span class="p">))</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">(-</span><span class="m">2.</span><span class="p">.</span><span class="m">2</span><span class="p">).</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">background</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="m">0.4</span><span class="p">*</span><span class="k">it</span><span class="p">,</span> <span class="m">0.7</span><span class="p">))</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">loadSprites</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">loadRock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">loadBomb</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">loadShot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">loadHero</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">loadRock</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">rock</span> <span class="p">=</span> <span class="n">BufferedImage</span><span class="p">(</span><span class="m">20</span><span class="p">,</span> <span class="m">20</span><span class="p">,</span> <span class="n">TYPE_4BYTE_ABGR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">g</span> <span class="p">=</span> <span class="n">rock</span><span class="p">.</span><span class="n">getGraphicsWithFont</span><span class="p">(</span><span class="nc">Font</span><span class="p">.</span><span class="n">Bold</span><span class="p">,</span> <span class="m">64.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">drawString</span><span class="p">(</span><span class="s2">&#34;*&#34;</span><span class="p">,</span> <span class="p">-</span><span class="m">2</span><span class="p">,</span> <span class="m">48</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">dispose</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">Image</span><span class="p">.</span><span class="n">getGraphicsWithFont</span><span class="p">(</span><span class="n">style</span> <span class="p">:</span><span class="n">Int</span> <span class="p">=</span><span class="nc">Font</span><span class="p">.</span><span class="n">NORMAL</span><span class="p">,</span> <span class="n">size</span> <span class="p">:</span><span class="n">Float</span> <span class="p">=</span><span class="m">18.0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">g</span> <span class="p">=</span> <span class="n">graphics</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">font</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">derive</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="nc">Color</span><span class="p">.</span><span class="n">BLACK</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">g</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="32-bewegliches-flugzeug">3.2 Bewegliches Flugzeug</h2>
<p>Offenbar brauchen wir Koordinaten für das Flugzeug, also</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">var</span> <span class="py">posX</span> <span class="p">=</span> <span class="m">0.0</span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">val</span> <span class="py">posY</span> <span class="p">=</span> <span class="m">0.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">override</span> <span class="k">fun</span> <span class="nf">paint</span><span class="p">(</span><span class="n">g</span> <span class="p">:</span><span class="n">Graphics</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">hero</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">posX</span><span class="p">),</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">posY</span><span class="p">),</span> <span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Außerdem wollen wir das Flugzeug bewegen, wennimmer wir die Tasten &lt;&lt;&ndash;&gt; oder &lt;&ndash;&gt;&gt; drücken, also</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">var</span> <span class="py">vx</span> <span class="p">=</span> <span class="m">0.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">override</span> <span class="k">fun</span> <span class="nf">accelerateLeft</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="n">vx</span> <span class="o">-=</span> <span class="m">0.01</span>
</span></span><span class="line"><span class="cl">     <span class="n">posX</span> <span class="o">+=</span> <span class="n">vx</span>
</span></span><span class="line"><span class="cl">     <span class="k">if</span> <span class="p">(</span><span class="n">posX</span><span class="o">&gt;=</span><span class="m">1.0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="n">posX</span> <span class="p">=</span> <span class="m">1.0</span>
</span></span><span class="line"><span class="cl">       <span class="n">vx</span> <span class="p">=</span> <span class="m">0.0</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="k">if</span> <span class="p">(</span><span class="n">posX</span><span class="o">&lt;=</span><span class="p">-</span><span class="m">1.0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="n">posX</span> <span class="p">=</span> <span class="p">-</span><span class="m">1.0</span>
</span></span><span class="line"><span class="cl">       <span class="n">vx</span> <span class="p">=</span> <span class="m">0.0</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="n">repaint</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">override</span> <span class="k">fun</span> <span class="nf">accelerateRight</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="n">vx</span> <span class="o">+=</span> <span class="m">0.01</span>
</span></span><span class="line"><span class="cl">     <span class="n">posX</span> <span class="o">+=</span> <span class="n">vx</span>
</span></span><span class="line"><span class="cl">     <span class="k">if</span> <span class="p">(</span><span class="n">posX</span><span class="o">&gt;=</span><span class="m">1.0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="n">posX</span> <span class="p">=</span> <span class="m">1.0</span>
</span></span><span class="line"><span class="cl">       <span class="n">vx</span> <span class="p">=</span> <span class="m">0.0</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="k">if</span> <span class="p">(</span><span class="n">posX</span><span class="o">&lt;=</span><span class="p">-</span><span class="m">1.0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="n">posX</span> <span class="p">=</span> <span class="p">-</span><span class="m">1.0</span>
</span></span><span class="line"><span class="cl">       <span class="n">vx</span> <span class="p">=</span> <span class="m">0.0</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="n">repaint</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Außerdem müssen wir die Form des Flugzeugs festlegen.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">loadHero</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">hero</span> <span class="p">=</span> <span class="n">BufferedImage</span><span class="p">(</span><span class="m">20</span><span class="p">,</span> <span class="m">20</span><span class="p">,</span> <span class="n">TYPE_4BYTE_ABGR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">g</span> <span class="p">=</span> <span class="n">hero</span><span class="p">.</span><span class="n">getGraphicsWithFont</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">drawString</span><span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span><span class="m">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">dispose</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Wenn du jetzt die fehlenden Methoden leer ergänzt &ndash; <code>override fun shoot() {}</code>, <code>private fun loadBomb() {}</code>, <code>private fun loadShot() {}</code> und <code>data class Shot() {}</code> &ndash; dann kannst du das Programm schon mal testen.  Es sollte ein paar Felsen am oberen Fensterrand malen und ein &ldquo;Flugzeug&rdquo; (also eigentlich ein &lsquo;A&rsquo;) am unteren Rand.  Wenn du die Tasten &lt;&lt;&ndash;&gt; und &lt;&ndash;&gt;&gt; drückst, bewegt sich das Flugzeug nach links oder rechts, umso schneller je öfter du drückst.</p>
<h2 id="33-schießen">3.3 Schießen</h2>
<p>Im Prinzip können wir Schüsse (engl. <code>shot</code>) einfach mit Folgendem erzeugen:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">override</span> <span class="k">fun</span> <span class="nf">shoot</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="n">shots</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Shot</span><span class="p">(</span><span class="n">posX</span><span class="p">,</span> <span class="n">posY</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">repaint</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Allerdings wollen wir, dass die Schüsse durch&rsquo;s Fenster fliegen.  Dazu brauchen wir 2 zusätzliche Dinge:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">kotlin.concurrent.timer</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SpaceShooter</span><span class="p">()</span> <span class="p">:</span><span class="n">GameComponent</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">var</span> <span class="py">timer</span> <span class="p">:</span><span class="n">Timer</span><span class="p">?</span> <span class="p">=</span><span class="k">null</span>
</span></span><span class="line"><span class="cl">  <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">override</span> <span class="k">fun</span> <span class="nf">paint</span><span class="p">(</span><span class="n">g</span> <span class="p">:</span><span class="n">Graphics</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">timer</span><span class="o">==</span><span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="n">timer</span> <span class="p">=</span> <span class="n">timer</span><span class="p">(</span><span class="n">daemon</span><span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="n">initialDelay</span><span class="p">=</span> <span class="m">100</span><span class="p">,</span> <span class="n">period</span><span class="p">=</span> <span class="m">100</span><span class="p">)</span> <span class="p">{</span> <span class="n">evolve</span><span class="p">()</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">evolve</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">shot</span> <span class="k">in</span> <span class="n">shots</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(!</span><span class="n">shot</span><span class="p">.</span><span class="n">fly</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="n">shots</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">shot</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="n">repaint</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">loadShot</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">shot</span> <span class="p">=</span> <span class="n">BufferedImage</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="n">TYPE_4BYTE_ABGR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">g</span> <span class="p">=</span> <span class="n">shot</span><span class="p">.</span><span class="n">getGraphicsWithFont</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">drawString</span><span class="p">(</span><span class="s2">&#34;^&#34;</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">dispose</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Damit ist klar, dass ein Schuss folgendes können muss:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">data</span> <span class="k">class</span> <span class="nc">Shot</span><span class="p">(</span><span class="k">var</span> <span class="py">x</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="k">var</span> <span class="py">y</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="k">val</span> <span class="py">vy</span> <span class="p">:</span><span class="n">Double</span> <span class="p">=</span><span class="m">0.1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">fly</span><span class="p">()</span> <span class="p">:</span><span class="n">Bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">y</span> <span class="o">+=</span> <span class="n">vy</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">y</span> <span class="k">in</span> <span class="p">-</span><span class="m">1.0</span><span class="o">..</span><span class="m">1.0</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">isUp</span> <span class="p">=</span> <span class="n">vy</span><span class="p">&gt;</span><span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Das Verhalten des Flugzeugs ist etwas komisch:  Es bewegt sich immer genau dann, wenn man eine der Tasten nach links oder nach rechts drückt.  Stattdessen brauchen wir eher folgendes Verhalten:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">evolve</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="n">posX</span> <span class="o">+=</span> <span class="n">vx</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">posX</span><span class="o">&lt;=</span><span class="p">-</span><span class="m">1.0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">posX</span> <span class="p">=</span> <span class="p">-</span><span class="m">1.0</span>
</span></span><span class="line"><span class="cl">      <span class="n">vx</span> <span class="p">=</span> <span class="m">0.0</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">posX</span><span class="o">&gt;=</span><span class="m">1.0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">posX</span> <span class="p">=</span> <span class="m">1.0</span>
</span></span><span class="line"><span class="cl">      <span class="n">vx</span> <span class="p">=</span> <span class="m">0.0</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">repaint</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">override</span> <span class="k">fun</span> <span class="nf">accelerateLeft</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">vs</span> <span class="o">-=</span> <span class="m">0.01</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">override</span> <span class="k">fun</span> <span class="nf">accelerateRight</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">vs</span> <span class="o">+=</span> <span class="m">0.01</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="34-explosionen">3.4 Explosionen</h2>
<p>Momentan gehen die Schüsse einfach durch die Felsen und verschwinden dann.  Stattdessen wollen wir aber, dass sie explodieren.  Das kann man etwa wie folgt erreichen:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">override</span> <span class="k">fun</span> <span class="nf">paint</span><span class="p">(</span><span class="n">g</span> <span class="p">:</span><span class="n">Graphics</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">pos</span> <span class="p">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">posX</span><span class="p">,</span> <span class="n">posY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">shot</span> <span class="k">in</span> <span class="n">shots</span><span class="p">.</span><span class="n">toList</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">obs</span> <span class="p">=</span> <span class="n">background</span><span class="p">.</span><span class="n">find</span> <span class="p">{</span> <span class="n">shot</span><span class="p">.</span><span class="n">hits</span><span class="p">(</span><span class="k">it</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">obs</span><span class="o">!=</span><span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="p">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">boom</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">shot</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">shot</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">background</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">shots</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">shot</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">shot</span><span class="p">.</span><span class="n">hits</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="p">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">boom</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">shot</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">shot</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">shots</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">shot</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">state</span> <span class="p">=</span> <span class="nc">State</span><span class="p">.</span><span class="n">EXPLODING</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">shot</span><span class="p">.</span><span class="n">isUp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="p">.</span><span class="n">drawImage</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">shot</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">shot</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">shot</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="p">.</span><span class="n">drawImage</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">bomb</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">shot</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">short</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nc">State</span><span class="p">.</span><span class="n">CONTINUE</span> <span class="o">-&gt;</span> <span class="n">g</span><span class="p">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">hero</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">posX</span><span class="p">),</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">posY</span><span class="p">),</span> <span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nc">State</span><span class="p">.</span><span class="n">EXPLODING</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="p">(</span><span class="n">remaining</span><span class="p">&gt;</span><span class="m">0.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="n">remaining</span> <span class="o">-=</span> <span class="m">0.1</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">          <span class="n">state</span> <span class="p">=</span> <span class="nc">State</span><span class="p">.</span><span class="n">GAME_OVER</span>
</span></span><span class="line"><span class="cl">      <span class="n">GAME_OVER</span> <span class="o">-&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="nc">Color</span><span class="p">.</span><span class="n">red</span><span class="p">.</span><span class="n">lighter</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="p">.</span><span class="n">font</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">derive</span><span class="p">(</span><span class="nc">Font</span><span class="p">.</span><span class="n">BOLD</span><span class="p">,</span> <span class="m">48.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="p">.</span><span class="n">drawString</span><span class="p">(</span><span class="s2">&#34;Game Over!&#34;</span><span class="p">,</span> <span class="n">width</span><span class="p">/</span><span class="m">2</span> <span class="p">-</span><span class="m">120</span><span class="p">,</span> <span class="n">height</span><span class="p">/</span><span class="m">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="nc">State</span><span class="p">.</span><span class="n">WINNING</span> <span class="o">-&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="p">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">hero</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">posX</span><span class="p">),</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">posY</span><span class="p">),</span> <span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="nc">Color</span><span class="p">.</span><span class="n">green</span><span class="p">.</span><span class="n">darker</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="p">.</span><span class="n">font</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">derive</span><span class="p">(</span><span class="nc">Font</span><span class="p">.</span><span class="n">BOLD</span><span class="p">,</span> <span class="m">48.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="p">.</span><span class="n">drawString</span><span class="p">(</span><span class="s2">&#34;You Win!!&#34;</span><span class="p">,</span> <span class="n">width</span><span class="p">/</span><span class="m">2</span> <span class="p">-</span><span class="m">120</span><span class="p">,</span> <span class="n">height</span><span class="p">/</span><span class="m">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">data</span> <span class="k">class</span> <span class="nc">Shot</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">hits</span><span class="p">(</span><span class="n">obs</span> <span class="p">:</span><span class="n">Point</span><span class="p">)</span> <span class="p">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">obs</span><span class="p">.</span><span class="n">x</span> <span class="p">-</span><span class="n">z</span><span class="p">)+</span><span class="n">abs</span><span class="p">(</span><span class="n">obs</span><span class="p">.</span><span class="n">y</span> <span class="p">-</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="m">0.09</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="35-dropping-bombs">3.5 Dropping Bombs</h2>
<p>Damit es nicht zu einfach wird zu gewinnen, wollen wir noch ab und zu Bomben auf das Flugzeug fallen lassen.  Dazu nehmen wir an, dass sich in den Felsen feindliche Bombenwerfer verstecken und diese zufällig eine Bombe fallen lassen.  Das kann man etwa so erreichen:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">val</span> <span class="py">random</span> <span class="p">=</span> <span class="n">Random</span><span class="p">(</span><span class="nc">System</span><span class="p">.</span><span class="n">currentMillis</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SpaceShooter</span><span class="p">()</span> <span class="p">:</span><span class="n">GameComponent</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">evolve</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">attack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">attack</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">==</span><span class="n">GAME_OVER</span> <span class="o">||</span> <span class="n">state</span><span class="o">==</span><span class="nc">State</span><span class="p">.</span><span class="n">WINNING</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">flipCoin</span><span class="p">(</span><span class="m">0.1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">background</span><span class="p">.</span><span class="n">isNotEmpty</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">enemy</span> <span class="p">=</span> <span class="n">background</span><span class="p">.</span><span class="n">random</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">shots</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Shot</span><span class="p">(</span><span class="n">enemy</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="m">0.7</span><span class="p">,</span> <span class="p">-</span><span class="m">0.02</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">background</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">      <span class="n">state</span> <span class="p">=</span> <span class="nc">State</span><span class="p">.</span><span class="n">WINNING</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">loadBomb</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">bomb</span> <span class="p">=</span> <span class="n">BufferedImage</span><span class="p">(</span><span class="m">16</span><span class="p">,</span> <span class="m">16</span><span class="p">,</span> <span class="n">TYPE_4BYTE_ABGR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">g</span> <span class="p">=</span> <span class="n">bomb</span><span class="p">.</span><span class="n">getGraphicWithFont</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">drawString</span><span class="p">(</span><span class="s2">&#34;v&#34;</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">15</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">dispose</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">Random</span><span class="p">.</span><span class="n">flipCoin</span><span class="p">(</span><span class="n">bias</span> <span class="p">:</span><span class="n">Double</span> <span class="p">=</span><span class="m">0.5</span><span class="p">)</span> <span class="p">=</span> <span class="n">nextDouble</span><span class="p">()</span> <span class="p">&lt;</span> <span class="n">bias</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Eine Münze zu werfen heißt im Englischen <code>flipCoin()</code>.  Für eine faire Münze ist die Wahrscheinlichkeit 50% (also 0.5).  Das tatsächliche Ergebnis hängt aber vom Zufall ab, d.h. wir brauchen eine Zufallsquelle (engl. <code>random</code>).  Diese müssen wir bei Programmstart initialisieren.  Das kann man am bequemsten tun, indem man einen Zufallsgenerator anlegt (<code>val random = Random(seed)</code>), allerdings brauchen wir noch einen Startwert (engl. seed), weil im Computer nichts wirklich zufällig abläuft.  Als recht zufälligen Startwert kann man die aktuelle Systemzeit in Millisekunden verwenden.  Selbst falls jemand das Spiel immer zur gleichen Uhrzeit spielt, wird er es kaum auf die Millisekunde genau zur gleichen Zeit starten.</p>
<p>Offenbar ist <code>fun Random.flipCoin(...)</code> eine Erweiterungsfunktion, d.h. sie ist eigentlich nicht in der Klasse (oder im Interface) von <code>Random</code> enthalten, aber wir können sie so bequem wie eine Methode aufrufen.  Entsprechend gibt es für Kollektionen (z.B. <code>List</code> oder <code>Set</code>) eine Erweiterungsfunktion (engl. extension function), die ein zufälliges Element auswählt.  Allerdings sollte man sicherstellen, dass die Kollektion nicht leer ist.</p>
<h1 id="4-noch-etwas-polieren">4. Noch etwas Polieren</h1>
<p>Ok, im Prinzip funktioniert das Spiel jetzt, aber einige unserer Methoden sind ziemlich lang, z.B. <code>fun paint(g :Grapgics)</code> hat ca. 30 Zeilen.  Das können wir reduzieren, indem wir die in kleinere Teile aufteilen, die wir dann aus der <code>paint</code>-Methode heraus aufrufen, etwa so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">var</span> <span class="py">points</span> <span class="p">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">paint</span><span class="p">(</span><span class="n">g</span> <span class="p">:</span><span class="n">Graphics</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">scale</span> <span class="p">=</span> <span class="n">computeScale</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">timer</span><span class="o">==</span><span class="k">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">timer</span> <span class="p">=</span> <span class="n">timer</span><span class="p">(</span><span class="n">daemon</span><span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">initialDelay</span><span class="p">=</span> <span class="m">100</span><span class="p">,</span> <span class="n">period</span><span class="p">=</span> <span class="m">100</span><span class="p">)</span> <span class="p">{</span> <span class="n">evolve</span><span class="p">()</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">paintRocks</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">paintShots</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">drawString</span><span class="p">(</span><span class="s2">&#34;Points: </span><span class="si">${points*100}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">paintForState</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">paintRocks</span><span class="p">(</span><span class="n">g</span> <span class="p">:</span><span class="n">Graphics</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">rock</span> <span class="k">in</span> <span class="n">background</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">g</span><span class="p">.</span><span class="n">drawImage</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">rock</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">rock</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">rock</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">paintShots</span><span class="p">(</span><span class="n">g</span> <span class="p">:</span><span class="n">Graphics</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">shot</span> <span class="k">in</span> <span class="n">shots</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">g</span><span class="p">.</span><span class="n">drawImage</span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="n">shot</span><span class="p">.</span><span class="n">isUp</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="n">shot</span> <span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="n">drop</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">shot</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">shot</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">obs</span> <span class="p">=</span> <span class="n">background</span><span class="p">.</span><span class="n">find</span> <span class="p">{</span> <span class="n">shot</span><span class="p">.</span><span class="n">isHitting</span><span class="p">(</span><span class="k">it</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">obs</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="p">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">boom</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">obs</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">obs</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">points</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">        <span class="n">background</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">paintForState</span><span class="p">(</span><span class="n">g</span> <span class="p">:</span><span class="n">Graphics</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nc">State</span><span class="p">.</span><span class="n">GAME_OVER</span> <span class="o">-&gt;</span> <span class="n">paintGameOver</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nc">State</span><span class="p">.</span><span class="n">WINNING</span> <span class="o">-&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">paintWon</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">paintHero</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">else</span> <span class="o">-&gt;</span> <span class="n">paintHero</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">paintWon</span><span class="p">(</span><span class="n">g</span> <span class="p">:</span><span class="n">Graphics</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="nc">Color</span><span class="p">.</span><span class="nc">GREEN</span><span class="p">.</span><span class="n">darker</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">font</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">deriveFont</span><span class="p">(</span><span class="nc">Font</span><span class="p">.</span><span class="n">BOLD</span><span class="p">,</span> <span class="m">48.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">drawString</span><span class="p">(</span><span class="s2">&#34;You Win!&#34;</span><span class="p">,</span> <span class="n">width</span><span class="p">/</span><span class="m">2</span> <span class="p">-</span><span class="m">120</span><span class="p">,</span> <span class="n">height</span><span class="p">/</span><span class="m">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">paintGameOver</span><span class="p">(</span><span class="n">g</span> <span class="p">:</span><span class="n">Graphics</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="nc">Color</span><span class="p">.</span><span class="nc">RED</span><span class="p">.</span><span class="n">brighter</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">font</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">deriveFont</span><span class="p">(</span><span class="nc">Font</span><span class="p">.</span><span class="n">BOLD</span><span class="p">,</span> <span class="m">48.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">.</span><span class="n">drawString</span><span class="p">(</span><span class="s2">&#34;Game Over!&#34;</span><span class="p">,</span> <span class="n">width</span><span class="p">/</span><span class="m">2</span> <span class="p">-</span><span class="m">120</span><span class="p">,</span> <span class="n">height</span><span class="p">/</span><span class="m">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">paintHero</span><span class="p">(</span><span class="n">g</span> <span class="p">:</span><span class="n">Graphics</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">==</span><span class="nc">State</span><span class="p">.</span><span class="n">EXPLODING</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">g</span><span class="p">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">boom</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">posX</span><span class="p">),</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">posY</span><span class="p">),</span> <span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">      <span class="n">g</span><span class="p">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">hero</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">posX</span><span class="p">),</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">posY</span><span class="p">),</span> <span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Eine andere recht lange Methode is <code>fun evolve()</code>.  Auch die können wir in 5 Teile zerlegen:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">evolve</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">attack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">replicateRocks</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">propagateShots</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">evolveHero</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">repaint</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// method attack() as before
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">propagateShots</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">shot</span> <span class="k">in</span> <span class="n">shots</span><span class="p">.</span><span class="n">toList</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(!</span><span class="n">shot</span><span class="p">.</span><span class="n">fly</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="n">shots</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">shot</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">evolveHero</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">moveHero</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">checkCollision</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">checkCollision</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="nc">State</span><span class="p">.</span><span class="n">EXPLODING</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">remaining</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">remaining</span> <span class="o">-=</span> <span class="m">0.1</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="n">state</span> <span class="p">=</span> <span class="nc">State</span><span class="p">.</span><span class="n">GAME_OVER</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">hero</span> <span class="p">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">posX</span><span class="p">,</span> <span class="n">posY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">shots</span><span class="p">.</span><span class="n">any</span> <span class="p">{</span> <span class="k">it</span><span class="p">.</span><span class="n">isHitting</span><span class="p">(</span><span class="n">hero</span><span class="p">)</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">state</span> <span class="p">=</span> <span class="nc">State</span><span class="p">.</span><span class="n">EXPLODING</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">moveHero</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">posX</span> <span class="o">+=</span> <span class="n">vx</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">posX</span> <span class="o">&gt;=</span> <span class="m">1.0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">posX</span> <span class="p">=</span> <span class="m">1.0</span>
</span></span><span class="line"><span class="cl">      <span class="n">vx</span> <span class="p">=</span> <span class="m">0.0</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">posX</span> <span class="p">&lt;</span> <span class="p">-</span><span class="m">1.0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">posX</span> <span class="p">=</span> <span class="p">-</span><span class="m">1.0</span>
</span></span><span class="line"><span class="cl">      <span class="n">vx</span> <span class="p">=</span> <span class="m">0.0</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="41-felsen-replizieren">4.1 Felsen Replizieren</h2>
<p>Im Prinzip sollte das Program noch so, wie vorher funktionieren.  Allerdings ist mir noch eine Idee gekommen:  Wenn der Held zu lange wartet, dann replizieren sich die Felsen, etwa so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">replicateRocks</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">background</span><span class="p">.</span><span class="n">size</span><span class="p">&lt;</span><span class="m">32</span> <span class="o">&amp;&amp;</span> <span class="n">random</span><span class="p">.</span><span class="n">flipCoin</span><span class="p">(</span><span class="m">0.05</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">candidates</span> <span class="p">=</span> <span class="n">generateBackground</span><span class="p">().</span><span class="n">filter</span> <span class="p">{</span> <span class="k">it</span> <span class="o">!in</span> <span class="n">background</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">background</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">candidates</span><span class="p">.</span><span class="n">random</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Dazu müssen wir aber das Erzeugen den Hintergrundes vom Füllen des Hintergrundes trennen, vielleicht so:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">fillBackground</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">background</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">background</span><span class="p">.</span><span class="n">addAll</span><span class="p">(</span><span class="n">generateBackground</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">private</span> <span class="k">fun</span> <span class="nf">generateBackground</span><span class="p">()</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">    <span class="p">(-</span><span class="m">9.</span><span class="p">.</span><span class="m">9</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">Point</span><span class="p">(</span><span class="k">it</span><span class="p">*</span><span class="m">0.1</span><span class="p">,</span> <span class="m">0.9</span><span class="p">)</span> <span class="p">}</span> <span class="p">+</span>
</span></span><span class="line"><span class="cl">        <span class="p">(-</span><span class="m">5.</span><span class="p">.&lt;</span> <span class="m">5</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">Point</span><span class="p">(</span><span class="m">0.2</span><span class="p">*</span><span class="k">it</span> <span class="p">+</span><span class="m">0.1</span><span class="p">,</span> <span class="m">0.8</span><span class="p">)</span> <span class="p">}</span> <span class="p">+</span>
</span></span><span class="line"><span class="cl">        <span class="p">(-</span><span class="m">2.</span><span class="p">.</span><span class="m">2</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">Point</span><span class="p">(</span><span class="m">0.4</span><span class="p">*</span><span class="k">it</span><span class="p">,</span> <span class="m">0.7</span><span class="p">)</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>So, jetzt kann man das Programm auch in 6 Monaten noch gut verstehen und man kann ganz gut damit spielen.</p>
<h1 id="9-selbst-probieren">9. Selbst Probieren</h1>
<p>Wie sieht es aus?  Funktioniert das Spiel bei dir?</p>
<p>Falls das Programm nicht auf Anhieb funktioniert, musst du dort schauen, wo die Fehlermeldung angezeigt wird.  Verstehst du, was der Code an dieser Stelle machen soll?  Worüber meckert der Compiler?  Wie kann man das beheben?</p>
<h2 id="91-ein-weiteres-level">9.1 Ein weiteres Level</h2>
<p>Wenn man alle Felsen entfernt hat, dann steht da &ldquo;You Win!!&rdquo;, aber es passiert nichts weiteres.  Vielleicht fällt dir etwas ein, was man im nächsten Level schwieriger machen kann.  Auch wäre es sicherlich nett, wenn man das Level anzeigen würde.  Dazu solltest du eine Eigenschaft (engl. property) in der Klasse einführen (z.B. <code>private var level = 1</code>) und die entsprechend in der <code>paint()</code>-Methode mit ausgeben (z.B. hinter den Punkten).</p>
<p>Viel Spaß beim Probieren und Tunen.</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">melli79</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2023-10-31
        
    </span>
  </p>
  <p class="copyright-item">
      <span class="item-title">Markdown</span>
      <span class="item-content"><a class="link-to-markdown" href="https://melli79.github.io/post/17spaceshooter/index.md" target="_blank">The Markdown version »</a></span>
    </p>
  
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/15cespaceshooter/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">15CE Space Shooter in C&#43;&#43;</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/07cefactorgame/">
            <span class="next-text nav-default">07CE Factor Game</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="comments-gitment"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/default.min.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/gitment.browser.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var gitment = new Gitment({
        id: '2023-10-31 19:20:50 \u002b0100 CET',
        title: '17. Weltraum-Shooter',
        link: decodeURI(location.href),
        desc: 'Nachdem wir letztens Wirbel im Computer animiert haben, wollen wir heute ein kleines animiertes Spiel produzieren.\nDas Ziel Warnung! Computerspiele lenken vom realen Leben ab. Das kann zur Vernachlässigung der realen Beziehungen, der Gesundheit führen, und kann die Entwicklung von Kindern und Jugendlichen beeinträchtigen und gefährden. Seid verantwortlich und begrenzt die Zeit für Computer- und Handy-Spiele.\nWarnung! Waffen und Kriege können verletzen und Menschen töten. Wenn diese Teil fiktionaler Spiele sind, heißt das nicht, dass sie harmlos wären.',
        owner: 'melli79',
        repo: '',
        oauth: {
          client_id: '',
          client_secret: ''
        }
      });
      gitment.render('comments-gitment');
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/imsun/gitment">comments powered by gitment.</a></noscript>

  

  
    <script src="https://utteranc.es/client.js"
            repo="melli79/"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:melchiorG@gMail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://www.linkedin.com/in/melchior-grutzmann-01741510/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="http://github.com/melli79/" class="iconfont icon-github" title="github"></a>
      <a href="https://www.instagram.com/gulinculture/" class="iconfont icon-instagram" title="instagram"></a>
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2020 - 
    2023
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">melli79</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.1c70606d1b733282f06230615f5561b5894924b6f9930ba2ab99cf1254f75a1a.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








</body>
</html>
