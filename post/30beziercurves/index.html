<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>30. Projekt Bézierkurven - Melchior&#39;s Homepage</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="melli79" /><meta name="description" content="Nachdem wir in den ersten 3 Teilen eine Einführung in Kotlin und Programmieren, sowie Grafikprogrammierung und vertiefende Algorithmen betrachtet haben, wollen uns jetzt mittelgroßen Projekten widmen. Heute fangen wir mit Bézierkurven an.
0. Die Aufgabe Gegeben ein paar Punkte in der Ebene, wie können wir eine glatte Kurve durch diese Punkte zeichnen?
Bild 1: Straklatte (engl. spline) durch 4 Punkte. CC P.S. Foresman 2007.
Wenn wir das mechanisch tun wollen, dann könnten wir die benachbarten Punkte mit einem Lineal (und Stift) verbinden." />






<meta name="generator" content="Hugo 0.109.0 with theme even" />


<link rel="canonical" href="https://melli79.github.io/post/30beziercurves/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.78d3a03abaed5d3c468bdf402fc110f36c046abf091a63421b9ce0a5a63db941.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="30. Projekt Bézierkurven" />
<meta property="og:description" content="Nachdem wir in den ersten 3 Teilen eine Einführung in Kotlin und Programmieren, sowie Grafikprogrammierung und vertiefende Algorithmen betrachtet haben, wollen uns jetzt mittelgroßen Projekten widmen. Heute fangen wir mit Bézierkurven an.
0. Die Aufgabe Gegeben ein paar Punkte in der Ebene, wie können wir eine glatte Kurve durch diese Punkte zeichnen?
Bild 1: Straklatte (engl. spline) durch 4 Punkte. CC P.S. Foresman 2007.
Wenn wir das mechanisch tun wollen, dann könnten wir die benachbarten Punkte mit einem Lineal (und Stift) verbinden." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://melli79.github.io/post/30beziercurves/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-02-20T18:12:00+01:00" />
<meta property="article:modified_time" content="2023-02-20T18:12:00+01:00" />
<meta itemprop="name" content="30. Projekt Bézierkurven">
<meta itemprop="description" content="Nachdem wir in den ersten 3 Teilen eine Einführung in Kotlin und Programmieren, sowie Grafikprogrammierung und vertiefende Algorithmen betrachtet haben, wollen uns jetzt mittelgroßen Projekten widmen. Heute fangen wir mit Bézierkurven an.
0. Die Aufgabe Gegeben ein paar Punkte in der Ebene, wie können wir eine glatte Kurve durch diese Punkte zeichnen?
Bild 1: Straklatte (engl. spline) durch 4 Punkte. CC P.S. Foresman 2007.
Wenn wir das mechanisch tun wollen, dann könnten wir die benachbarten Punkte mit einem Lineal (und Stift) verbinden."><meta itemprop="datePublished" content="2023-02-20T18:12:00+01:00" />
<meta itemprop="dateModified" content="2023-02-20T18:12:00+01:00" />
<meta itemprop="wordCount" content="5449">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="30. Projekt Bézierkurven"/>
<meta name="twitter:description" content="Nachdem wir in den ersten 3 Teilen eine Einführung in Kotlin und Programmieren, sowie Grafikprogrammierung und vertiefende Algorithmen betrachtet haben, wollen uns jetzt mittelgroßen Projekten widmen. Heute fangen wir mit Bézierkurven an.
0. Die Aufgabe Gegeben ein paar Punkte in der Ebene, wie können wir eine glatte Kurve durch diese Punkte zeichnen?
Bild 1: Straklatte (engl. spline) durch 4 Punkte. CC P.S. Foresman 2007.
Wenn wir das mechanisch tun wollen, dann könnten wir die benachbarten Punkte mit einem Lineal (und Stift) verbinden."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Melchior&#39;s Homepage</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Themes</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Melchior&#39;s Homepage</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Themes</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">30. Projekt Bézierkurven</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-02-20 </span>
        <div class="post-category">
            <a href="/categories/kotlin/"> Kotlin </a>
            <a href="/categories/programming/"> Programming </a>
            <a href="/categories/projekt/"> Projekt </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#0-die-aufgabe">0. Die Aufgabe</a></li>
    <li><a href="#1-vollständige-interpolation">1. Vollständige Interpolation</a></li>
    <li><a href="#2-ein-funktionen-plotter">2. Ein Funktionen-Plotter</a></li>
    <li><a href="#3-lösen-von-linearen-gleichungssystemen">3. Lösen von linearen Gleichungssystemen</a></li>
    <li><a href="#4-eine-idee-von-bézier-und-casteljau">4. Eine Idee von Bézier und Casteljau</a></li>
    <li><a href="#5-berechnung-der-koeffizienten">5. Berechnung der Koeffizienten</a></li>
    <li><a href="#9-selber-experimentieren">9. Selber Experimentieren</a>
      <ul>
        <li><a href="#92-numerische-bibliothek-verwenden">9.2 Numerische Bibliothek Verwenden</a></li>
        <li><a href="#99-zusammenfassung">9.9 Zusammenfassung</a></li>
      </ul>
    </li>
    <li><a href="#weiterführende-literatur">Weiterführende Literatur</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Nachdem wir in den ersten 3 Teilen eine Einführung in Kotlin und Programmieren, sowie Grafikprogrammierung und vertiefende Algorithmen betrachtet haben, wollen uns jetzt mittelgroßen Projekten widmen. Heute fangen wir mit Bézierkurven an.</p>
<h1 id="0-die-aufgabe">0. Die Aufgabe</h1>
<p>Gegeben ein paar Punkte in der Ebene, wie können wir eine glatte Kurve durch diese Punkte zeichnen?</p>
<p><img src="/img/Straklatte.slim.jpg" alt="Straklatte (engl. spline) durch 4 Punkte. CC P.S. Foresman 2007">
Bild 1: Straklatte (engl. spline) durch 4 Punkte. CC P.S. Foresman 2007.</p>
<p>Wenn wir das mechanisch tun wollen, dann könnten wir die benachbarten Punkte mit einem Lineal (und Stift) verbinden.  Wenn wir aber eine glattere Kurve (ohne Ecken) haben wollen, dann können wir vielleicht eine Straklatte (englisch spline) verwenden.  Diese wird an 2 Punkten eingespannt und an 2 weiteren Punkten dazwischen abgestützt.  Dann kann man mit einem Stift (oder Cutter) eine Kurve entlang des Bands ziehen.  Wenn man das ganze mehrfach ansetzt und dabei die Punkte der Reihe nach durchgeht, dann erhält man eine glatte Kurve durch alle Punkte.  Als Ergebnis kann man etwa das Folgende erhalten.</p>
<p><img src="/img/splinesApproximatingSine.png" alt="Eine glatte Kurve durch ein paar Punkte. CC M. Grützmann 2023."></p>
<p>Bild 2: Eine glatte Kurve durch ein paar Punkte. CC M. Grützmann 2023.</p>
<p>Die Frage ist, wie man das im Computer durchführen kann.</p>
<p>Als Literatur kann man [1] oder [2] verwenden.  Ich gebe hier eine minimale Zusammenfassung.</p>
<p>[1] <a href="https://de.wikipedia.org/wiki/B%C3%A9zierkurve">wiki: Bézierkurven</a></p>
<p>[2] L.L. Schumaker: <em>Spline Functions, Basic Theory</em>, <strong>1981</strong>.</p>
<h1 id="1-vollständige-interpolation">1. Vollständige Interpolation</h1>
<p>Gegeben seien $n+1$ Punkte mit den Koordinaten $(x_0,y_0)$ bis $(x_n, y_n)$.  Wir können einfach ein Polynom n-ten Grades durch diese Punkte legen, so wie wir das letztens bei den Fehlerkorrektur-Codes getan haben.  Dazu müssen wir das lineare Gleichungssystem $X\mathbf a = \mathbf y$ lösen.  Wir hatten festgestellt, dass die Matrix
$$ X = \begin{pmatrix}
1 &amp; x_0 &amp; x_0^2 &amp; \dots &amp; x_0^n \\
1 &amp; x_1 &amp; x_1^2 &amp; \dots &amp; x_1^n \\
\vdots &amp;&amp;       &amp;       &amp;       \\
1 &amp; x_n &amp; x_n^2 &amp; \dots &amp; x_n^n
\end{pmatrix} $$
darüber entscheidet, ob das Gleichungssystem eindeutig lösbar ist.  Die rechte Seite ist der Vektor $\mathbf y = (y_0, y_1, \dots,y_n)^T$ und die Unbekannten sind die Koeffizienten $\mathbf a = (a_0, a_1,\dots, a_n)^T$.</p>
<p>Solange wird die Stützstellen $x_0, x_1,\dots, x_n$ alle verschieden wählen, ist das Gleichungssystem eindeutig lösbar. (Die Koeffizienten $X$ sind die van der Monde Matrix und deren Determinante ist die van der Monde Determinante.)</p>
<p>Die Frage ist, wie gut das ist.  Dazu könnten wir die Größe</p>
<p>$$ \mathrm{RMSE} = \left[\int_a^b \left(f(x)-p(x)\right)^2\,dx\right]^{1/2} $$</p>
<p>ausrechnen.  Allerdings müssen wir die Originalfunktion $f\colon[a,b]\to\mathbb R$ an mehr als den $n+1$ Stellen kennen, denn an diesen Stellen ist die Differenz 0 (bis auf Rundungsfehler).</p>
<p>Alternativ können wir das Ergebnis der Orginalfunktion $f$, der Interpolation $p$ und vielleicht des Fehlers error$(x)= p(x)-f(x)$ plotten.  Da wir sowieso einige Ergebnisse darstellen wollen, entwerfen wir gleich mal ein Programm, um reelle Funktionen zu plotten.</p>
<h1 id="2-ein-funktionen-plotter">2. Ein Funktionen-Plotter</h1>
<p>Da wir bereits mit Swing umgehen können, schreiben wir ein Programm mit Swing, in dem eine reelle Funktion dargestellt wird.  Das kann etwa wie folgt losgehen:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">MyWindow</span><span class="p">(</span><span class="n">content</span> <span class="p">:</span><span class="n">JComponent</span><span class="p">)</span> <span class="p">:</span><span class="n">JFrame</span><span class="p">(</span><span class="s2">&#34;Function Plotter&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">init</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="n">layout</span> <span class="p">=</span> <span class="n">BorderLayout</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="n">contentPane</span> <span class="p">=</span> <span class="n">content</span>
</span></span><span class="line"><span class="cl">      <span class="n">setSize</span><span class="p">(</span><span class="m">800</span><span class="p">,</span> <span class="m">600</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">defaultCloseOperation</span> <span class="p">=</span> <span class="n">EXIT_ON_CLOSE</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">n</span> <span class="p">=</span> <span class="m">5</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">xs</span> <span class="p">=</span> <span class="p">(-</span><span class="n">n</span><span class="o">..</span><span class="n">n</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">toDouble</span><span class="p">()/</span><span class="n">n</span><span class="p">)</span> <span class="p">}.</span><span class="n">toDoubleArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">domain</span> <span class="p">=</span> <span class="n">DoubleRange</span><span class="p">(-</span><span class="m">1.0</span><span class="p">,</span> <span class="m">1.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">f</span> <span class="p">=</span> <span class="n">DescribedFunction</span><span class="p">(</span><span class="s2">&#34;1/(1+x^2)&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="m">1</span><span class="p">/(</span><span class="m">1</span><span class="p">+</span><span class="n">x</span><span class="p">*</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">window</span> <span class="p">=</span> <span class="n">MyWindow</span><span class="p">(</span><span class="n">Plotter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">domain</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">window</span><span class="p">.</span><span class="n">isVisible</span> <span class="p">=</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Dazu haben wir bereits ein paar Abstraktionen eingeführt:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="nd">@OptIn</span><span class="p">(</span><span class="n">ExperimentalStdlibApi</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">data</span> <span class="k">class</span> <span class="nc">DoubleRange</span><span class="p">(</span><span class="k">override</span> <span class="k">val</span> <span class="py">start</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="k">override</span> <span class="k">val</span> <span class="py">endExclusive</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">:</span><span class="n">OpenEndRange</span><span class="p">&lt;</span><span class="n">Double</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">width</span> <span class="p">=</span> <span class="n">endExclusive</span> <span class="p">-</span> <span class="n">start</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">init</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">assert</span><span class="p">(</span><span class="n">start</span><span class="p">&lt;</span><span class="n">endExclusive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">partition</span><span class="p">(</span><span class="n">n</span> <span class="p">:</span><span class="n">UInt</span><span class="p">)</span> <span class="p">:</span><span class="n">DoubleArray</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">dx</span> <span class="p">=</span> <span class="n">width</span><span class="p">/</span><span class="n">n</span><span class="p">.</span><span class="n">toInt</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">(</span><span class="m">0u</span><span class="o">..</span><span class="n">n</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">start</span> <span class="p">+</span><span class="n">dx</span><span class="p">*</span><span class="n">i</span><span class="p">.</span><span class="n">toInt</span><span class="p">()</span> <span class="p">}.</span><span class="n">toDoubleArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ein <code>DoubleRange</code> ist ein Interval, d.h. es hat einen Startpunkt und einen Endpunkt.  Englisch exclusive heißt ausgeschlossen, d.h. dass der Endpunkt selbst nicht zum Interval gehört.  Eine Partition ist eine Unterteilung des Intervals in $n+1$ Punkte, wobei der 0. Punkt der Startpunkt ist und der $n$-te Punkt der Endpunkt ist.  Wir wollen hier äquidistant unterteilen, d.h. alle Zwischenpunkte sind voneinander gleichweit entfernt.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">data</span> <span class="k">class</span> <span class="nc">DescribedFunction</span><span class="p">(</span><span class="k">val</span> <span class="py">name</span> <span class="p">:</span><span class="n">String</span><span class="p">,</span> <span class="k">val</span> <span class="py">f</span> <span class="p">:(</span><span class="n">Double</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">f</span><span class="p">(</span><span class="n">xs</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">)</span> <span class="p">=</span> <span class="n">xs</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}.</span><span class="n">toDoubleArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>D.h. eine beschriebene Funktion besteht aus dem Funktionsnamen und der Vorschrift, wie man aus <code>x</code> den Funktionswert berechnet.  Wir implementieren gleich noch eine Methode, die wir auch <code>f</code> nennen, die aus einem Vektor von <code>x</code>-Werten gleich den Vektor der <code>y</code>-Werte berechnet.</p>
<p>Wie sieht nun der <code>Plotter</code> aus?</p>
<p>Ein erster Entwurf könnte wie folgt sein:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">Plotter</span><span class="p">(</span><span class="k">val</span> <span class="py">fs</span> <span class="p">:</span><span class="n">List</span><span class="p">&lt;</span><span class="n">DescribedFunction</span><span class="p">&gt;,</span> <span class="k">val</span> <span class="py">domain</span> <span class="p">:</span><span class="n">DoubleRange</span> <span class="p">=</span><span class="n">DoubleRange</span><span class="p">(</span><span class="m">0.0</span><span class="p">,</span> <span class="m">1.0</span><span class="p">))</span> <span class="p">:</span><span class="n">JComponent</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">colors</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="nc">Color</span><span class="p">.</span><span class="n">BLACK</span><span class="p">,</span> <span class="nc">Color</span><span class="p">.</span><span class="n">BLUE</span><span class="p">,</span> <span class="nc">Color</span><span class="p">.</span><span class="nc">GREEN</span><span class="p">.</span><span class="n">darker</span><span class="p">(),</span> <span class="nc">Color</span><span class="p">.</span><span class="n">RED</span><span class="p">,</span> <span class="nc">Color</span><span class="p">.</span><span class="nc">ORANGE</span><span class="p">.</span><span class="n">darker</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="nc">Color</span><span class="p">.</span><span class="nc">CYAN</span><span class="p">.</span><span class="n">darker</span><span class="p">(),</span> <span class="nc">Color</span><span class="p">.</span><span class="nc">MAGENTA</span><span class="p">.</span><span class="n">darker</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">var</span> <span class="py">n</span> <span class="p">=</span> <span class="m">1024u</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">lateinit</span> <span class="k">var</span> <span class="py">xs</span> <span class="p">:</span><span class="n">DoubleArray</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">lateinit</span> <span class="k">var</span> <span class="py">range</span> <span class="p">:</span><span class="n">DoubleRange</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">val</span> <span class="py">ys</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="n">DoubleArray</span><span class="p">&gt;()</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">lateinit</span> <span class="k">var</span> <span class="py">scale</span> <span class="p">:</span><span class="n">Scale</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">init</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">assert</span><span class="p">(</span><span class="n">fs</span><span class="p">.</span><span class="n">isNotEmpty</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">      <span class="n">recompute</span><span class="p">(</span><span class="m">1024u</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">ym</span> <span class="p">=</span> <span class="n">ys</span><span class="p">.</span><span class="n">minOf</span> <span class="p">{</span> <span class="k">it</span><span class="p">.</span><span class="n">min</span><span class="p">()</span> <span class="p">};</span>  <span class="k">val</span> <span class="py">yM</span> <span class="p">=</span> <span class="n">ys</span><span class="p">.</span><span class="n">maxOf</span> <span class="p">{</span> <span class="k">it</span><span class="p">.</span><span class="n">max</span><span class="p">()</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">range</span> <span class="p">=</span> <span class="n">DoubleRange</span><span class="p">(</span><span class="n">ym</span><span class="p">,</span> <span class="n">yM</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">recompute</span><span class="p">(</span><span class="n">n</span> <span class="p">:</span><span class="n">UInt</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="n">n</span> <span class="p">=</span> <span class="n">n</span>
</span></span><span class="line"><span class="cl">      <span class="n">xs</span> <span class="p">=</span> <span class="n">domain</span><span class="p">.</span><span class="n">partitition</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">ys</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">fs</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">f</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="n">ys</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="n">xs</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">paint</span><span class="p">(</span><span class="n">g</span> <span class="p">:</span><span class="n">Graphics</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">scale</span> <span class="p">=</span> <span class="n">computeScale</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">g</span><span class="p">.</span><span class="n">drawAxes</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">g</span><span class="p">.</span><span class="n">drawCurves</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">g</span><span class="p">.</span><span class="n">drawLabel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">Graphics</span><span class="p">.</span><span class="n">drawCurves</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">ys</span><span class="p">.</span><span class="n">forEachIndexed</span> <span class="p">{</span> <span class="n">k</span><span class="p">,</span> <span class="n">ys1</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="n">color</span> <span class="p">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">k</span> <span class="p">%</span> <span class="n">colors</span><span class="p">.</span><span class="n">size</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">var</span> <span class="py">x0</span> <span class="p">=</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="m">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="k">var</span> <span class="py">y0</span> <span class="p">=</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">ys1</span><span class="p">[</span><span class="m">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">xs</span><span class="p">.</span><span class="n">zip</span><span class="p">(</span><span class="n">ys1</span><span class="p">).</span><span class="n">forEach</span> <span class="p">{</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="k">val</span> <span class="py">x1</span> <span class="p">=</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="k">val</span> <span class="py">y1</span> <span class="p">=</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="n">drawLine</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="n">x0</span> <span class="p">=</span> <span class="n">x1</span><span class="p">;</span>  <span class="n">y0</span> <span class="p">=</span> <span class="n">y1</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">Graphics</span><span class="p">.</span><span class="n">drawLabel</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">x</span> <span class="p">=</span> <span class="n">width</span> <span class="p">-</span><span class="m">150</span>
</span></span><span class="line"><span class="cl">      <span class="k">var</span> <span class="py">y</span> <span class="p">=</span> <span class="m">16</span>
</span></span><span class="line"><span class="cl">      <span class="n">fs</span><span class="p">.</span><span class="n">forEachIndexed</span> <span class="p">{</span> <span class="n">k</span><span class="p">,</span> <span class="n">f</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="n">color</span> <span class="p">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">k</span> <span class="p">%</span> <span class="n">colors</span><span class="p">.</span><span class="n">size</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">drawLine</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">-</span><span class="m">4</span><span class="p">,</span> <span class="n">x</span><span class="p">+</span><span class="m">10</span><span class="p">,</span> <span class="n">y</span><span class="p">-</span><span class="m">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">drawString</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">+</span><span class="m">12</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">y</span> <span class="o">+=</span> <span class="m">16</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">Graphics</span><span class="p">.</span><span class="n">drawAxes</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">color</span> <span class="p">=</span> <span class="nc">Color</span><span class="p">.</span><span class="n">GRAY</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">x0</span> <span class="p">=</span> <span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="m">0.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">drawLine</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span><span class="n">height</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">drawString</span><span class="p">(</span><span class="s2">&#34;y&#34;</span><span class="p">,</span> <span class="n">x0</span><span class="p">-</span><span class="m">16</span><span class="p">,</span> <span class="m">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">y0</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="m">0.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">drawLine</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span><span class="n">y0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">drawString</span><span class="p">(</span><span class="s2">&#34;x&#34;</span><span class="p">,</span> <span class="n">width</span><span class="p">-</span><span class="m">50</span><span class="p">,</span> <span class="n">y0</span><span class="p">-</span><span class="m">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">computeScale</span><span class="p">(</span><span class="n">width</span> <span class="p">:</span><span class="n">Int</span><span class="p">,</span> <span class="n">height</span> <span class="p">:</span><span class="n">Int</span><span class="p">)</span> <span class="p">:</span><span class="n">Scale</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">dx</span> <span class="p">=</span> <span class="n">width</span><span class="p">/</span><span class="n">domain</span><span class="p">.</span><span class="n">width</span><span class="p">*</span><span class="m">0.9</span><span class="p">;</span>  <span class="k">val</span> <span class="py">dy</span> <span class="p">=</span> <span class="n">height</span><span class="p">/</span><span class="n">range</span><span class="p">.</span><span class="n">width</span><span class="p">*</span><span class="m">0.9</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="n">start</span> <span class="p">-(</span><span class="n">width</span><span class="p">/</span><span class="n">dx</span><span class="p">-</span><span class="n">domain</span><span class="p">.</span><span class="n">width</span><span class="p">)*</span><span class="m">0.45</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">range</span><span class="p">.</span><span class="n">endExclusive</span> <span class="p">+(</span><span class="n">height</span><span class="p">/</span><span class="n">dy</span><span class="p">-</span><span class="n">range</span><span class="p">.</span><span class="n">height</span><span class="p">)*</span><span class="m">0.45</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="p">-</span><span class="n">dy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">data</span> <span class="k">class</span> <span class="nc">Scale</span><span class="p">(</span><span class="k">val</span> <span class="py">x0</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="n">y0</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="n">dx</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="n">dy</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">fun</span> <span class="nf">px</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">=</span> <span class="p">((</span><span class="n">x</span><span class="p">-</span><span class="n">x0</span><span class="p">)*</span><span class="n">dx</span><span class="p">).</span><span class="n">roundToInt</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">fun</span> <span class="nf">py</span><span class="p">(</span><span class="n">y</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">=</span> <span class="p">((</span><span class="n">y</span><span class="p">-</span><span class="n">y0</span><span class="p">)*</span><span class="n">dy</span><span class="p">).</span><span class="n">roundToInt</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Was macht diese Klasse?</p>
<p>Naja, zur Initialisierung übergibt man eine Liste <code>DescribedFunction</code>s, d.h. Funktionen mit Namen, einen Definitionsbereicht (engl. <code>domain</code>) und dann wird eine Partition des Definitionsbereiches in <code>n=1024</code> Stellen berechnet und zu diesen $n+1$ Stellen die <code>y</code>-Werte und das für alle übergebenen Funktionen.</p>
<p>Die grafischen Aktionen werden von der <code>paint(...)</code>-Methode ausgeführt und sind zunächst das Neuberechnen der Skala, das Malen der Axen, das Malen der Kurven und dann noch das Malen einer Legende (engl. label).</p>
<p>Dir Kurven werden in der oben definierten Farbskala gemalt, d.h. die erste Kurven in schwarz (engl. <code>BLACK</code>), dann blau (engl. <code>BLUE</code>), dunkelgrün (engl. <code>GREEN</code> und <code>darker()</code> heißt dunkler), rot (engl. <code>RED</code>), orange, türkis (engl. <code>CYAN</code>), violett (engl. <code>MAGENTA</code>).  Falls mehr als 7 Kurven angegeben sind, dann wird wieder von vorn begonnen mit der Farbskala.</p>
<p>Die Berechnung der Skalierung sollte dir schon bekannt vorkommen.  In diesem Falle skalieren wir die <code>x</code>- und die <code>y</code>-Achse unabhängig, da ja nicht klar ist, dass Definitions- und Wertebereich gleichgroß sind.</p>
<p>Wenn man die <code>x</code>-Achse einzeichnen will, dann muss man zunächst herausfinden, bei welcher <code>y</code>-Koordinate, die eingezeichnet werden muss.  Die Antwort ist <code>y0 = scale.py(0.0)</code>, d.h. bei $y=0$ aber eben in Bildschirmkoordinaten.  Entsprechend muss man die <code>y</code>-Achse bei <code>x0 = scale.px(0.0)</code> einzeichnen.</p>
<p>Schließlich besteht die Legende (engl. label) aus den Namen (<code>f.name</code>) in den Farben der Kurven.  Dazu müssen wir einen Text in das Grafikfenster malen, <code>drawText(txt, px,py)</code>.  Ich habe entschieden, dass die Legende rechts-oben sein soll, also 150 Punkte links vom rechten Rand <code>val x = width -150</code> und beginnend 16 Punkte vom oberen Rand <code>var y = 16</code>.  Beim malen eines Textes muss man die linke untere Ecke von Text angeben, d.h. man kann nicht einfach <code>width, 0</code> angeben, da sonst der Text außerhalb des Bildschirms liegt.</p>
<p>Kann man das jetzt schon testen? &ndash; Probier&rsquo;s aus!</p>
<p>Leider kompiliert es nicht.  Das wichtigste Problem (wenn du alle Teile fehlerfrei abgetippt hast und die entsprechenden Symbole importiert hast) ist, dass zum Erzeugen des Plotters man eine Liste von <code>DescribedFunction</code> übergeben muss, wir aber nur 1 Funktion malen wollen.  Was kann man da machen?</p>
<p>Wir könnten den Aufruf anpassen, sodass statt <code>Plotter(f, domain)</code> einfach <code>Plotter(listOf(f), domain)</code> übergeben wird.  Andererseits können wir auch Kotlin mitteilen, dass wenn nur eine Funktion übergeben wird, diese automatisch in eine Liste umgewandelt werden soll.  Wie kann man das machen?</p>
<p>Dazu ergänzen wir einen 2. Konstruktor in der Klasse <code>Plotter</code> (vor der <code>init</code>-Methode), wie folgt:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">constructor</span><span class="p">(</span><span class="n">f</span> <span class="p">:</span><span class="n">DescribedFunction</span><span class="p">,</span> <span class="n">domain</span> <span class="p">:</span><span class="n">DoubleRange</span><span class="p">)</span> <span class="p">:</span><span class="k">this</span><span class="p">(</span><span class="n">listOf</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">domain</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Die Notation <code>:this(...)</code> ist etwas speziell.  Sie besagt, dass die Klasse wie üblich initialisiert wird.  Dazu müssen wir aber die üblichen Argumente übergeben, also eine Liste von <code>DescribedFunction</code> und den Definitionsbereich, den wir ja erhalten hatten.</p>
<p>Wichtig wäre, dass du die Funktionsweise erst einmal testest, um dich davon zu überzeugen, dass dieser Teil bereits funktioniert.</p>
<h1 id="3-lösen-von-linearen-gleichungssystemen">3. Lösen von linearen Gleichungssystemen</h1>
<p>Um jetzt die Interpolation vom Anfang zu malen, muss man das entsprechende lineare Gleichungssystem lösen.  Dazu können wir etwa Matrizen (reeller Zahlen) definieren und den Gauß-Algorithmus vom letzten Mal verwenden.  Das sieht etwa wie folgt aus:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span><span class="lnt">99
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">data</span> <span class="k">class</span> <span class="nc">RMatrix</span><span class="p">(</span><span class="k">private</span> <span class="k">val</span> <span class="py">cs</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">,</span> <span class="k">val</span> <span class="py">n</span> <span class="p">:</span><span class="n">UInt</span><span class="p">)</span> <span class="p">:</span><span class="n">Clonable</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">m</span> <span class="p">=</span> <span class="n">cs</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">toUInt</span><span class="p">()/</span><span class="n">n</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">init</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">assert</span><span class="p">(</span><span class="n">m</span><span class="p">*</span><span class="n">n</span> <span class="o">==</span> <span class="n">cs</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">toUInt</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">clone</span><span class="p">()</span> <span class="p">=</span> <span class="n">RMatrix</span><span class="p">(</span><span class="n">cs</span><span class="p">.</span><span class="n">clone</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">=</span> <span class="s2">&#34;(&#34;</span> <span class="p">+</span> <span class="p">(</span><span class="m">0u</span> <span class="n">until</span> <span class="n">m</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">r</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="n">r</span> <span class="p">*</span><span class="n">n</span> <span class="n">until</span> <span class="p">(</span><span class="n">r</span> <span class="p">+</span><span class="m">1u</span><span class="p">)</span> <span class="p">*</span><span class="n">n</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">offset</span> <span class="o">-&gt;</span> <span class="n">cs</span><span class="p">[</span><span class="n">offset</span><span class="p">.</span><span class="n">toInt</span><span class="p">()]</span> <span class="p">}.</span><span class="n">joinToString</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}.</span><span class="n">joinToString</span><span class="p">(</span><span class="s2">&#34;)</span><span class="se">\n</span><span class="s2">(&#34;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&#34;)&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">operator</span> <span class="k">fun</span> <span class="nf">get</span><span class="p">(</span><span class="n">r</span> <span class="p">:</span><span class="n">UInt</span><span class="p">,</span> <span class="n">c</span> <span class="p">:</span><span class="n">UInt</span><span class="p">)</span> <span class="p">=</span> <span class="n">cs</span><span class="p">[(</span><span class="n">r</span><span class="p">*</span><span class="n">n</span><span class="p">).</span><span class="n">toInt</span><span class="p">()</span> <span class="p">+</span><span class="n">c</span><span class="p">.</span><span class="n">toInt</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">operator</span> <span class="k">fun</span> <span class="nf">set</span><span class="p">(</span><span class="n">r</span> <span class="p">:</span><span class="n">UInt</span><span class="p">,</span> <span class="n">c</span> <span class="p">:</span><span class="n">UInt</span><span class="p">,</span> <span class="k">value</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">cs</span><span class="p">[(</span><span class="n">r</span><span class="p">*</span><span class="n">n</span><span class="p">).</span><span class="n">toInt</span><span class="p">()</span> <span class="p">+</span><span class="n">c</span><span class="p">.</span><span class="n">toInt</span><span class="p">()]</span> <span class="p">=</span> <span class="k">value</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">slice</span><span class="p">(</span><span class="n">r</span> <span class="p">:</span><span class="n">UInt</span><span class="p">)</span> <span class="p">=</span> <span class="n">cs</span><span class="p">.</span><span class="n">slice</span><span class="p">((</span><span class="n">r</span> <span class="p">*</span> <span class="n">n</span><span class="p">).</span><span class="n">toInt</span><span class="p">()</span> <span class="n">until</span> <span class="p">((</span><span class="n">r</span> <span class="p">+</span> <span class="m">1u</span><span class="p">)</span> <span class="p">*</span> <span class="n">n</span><span class="p">).</span><span class="n">toInt</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">copy</span><span class="p">(</span><span class="n">pad</span> <span class="p">:</span><span class="n">UInt</span><span class="p">)</span> <span class="p">=</span> <span class="n">RMatrix</span><span class="p">((</span><span class="m">0u</span> <span class="n">until</span> <span class="n">m</span><span class="p">).</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">r</span> <span class="o">-&gt;</span> <span class="n">slice</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">+(</span><span class="m">1u</span><span class="o">..</span><span class="n">pad</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="m">0.0</span> <span class="p">}</span> <span class="p">}.</span><span class="n">toDoubleArray</span><span class="p">(),</span> <span class="n">n</span><span class="p">+</span><span class="n">pad</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">paste</span><span class="p">(</span><span class="n">r0</span> <span class="p">:</span><span class="n">UInt</span><span class="p">,</span> <span class="n">c0</span> <span class="p">:</span><span class="n">UInt</span><span class="p">,</span> <span class="n">ys</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">assert</span><span class="p">(</span><span class="n">r0</span> <span class="p">+</span> <span class="n">ys</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">toUInt</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">ys</span><span class="p">.</span><span class="n">forEachIndexed</span> <span class="p">{</span> <span class="n">k</span><span class="p">,</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="k">set</span><span class="p">(</span><span class="n">r0</span> <span class="p">+</span><span class="n">k</span><span class="p">.</span><span class="n">toUInt</span><span class="p">(),</span> <span class="n">c0</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">swap</span><span class="p">(</span><span class="n">r</span> <span class="p">:</span><span class="n">UInt</span><span class="p">,</span> <span class="n">r0</span> <span class="p">:</span><span class="n">UInt</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="n">r0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">        <span class="n">assert</span><span class="p">(</span><span class="n">r</span> <span class="p">&lt;</span> <span class="n">m</span> <span class="o">&amp;&amp;</span> <span class="n">r0</span> <span class="p">&lt;</span> <span class="n">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">offset</span> <span class="p">=</span> <span class="p">(</span><span class="n">r</span> <span class="p">*</span> <span class="n">n</span><span class="p">).</span><span class="n">toInt</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">offset0</span> <span class="p">=</span> <span class="p">(</span><span class="n">r0</span> <span class="p">*</span> <span class="n">n</span><span class="p">).</span><span class="n">toInt</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">c</span> <span class="k">in</span> <span class="m">0</span> <span class="n">until</span> <span class="n">n</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">val</span> <span class="py">tmp</span> <span class="p">=</span> <span class="n">cs</span><span class="p">[</span><span class="n">offset</span> <span class="p">+</span> <span class="n">c</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">cs</span><span class="p">[</span><span class="n">offset</span> <span class="p">+</span> <span class="n">c</span><span class="p">]</span> <span class="p">=</span> <span class="n">cs</span><span class="p">[</span><span class="n">offset0</span> <span class="p">+</span> <span class="n">c</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">cs</span><span class="p">[</span><span class="n">offset0</span> <span class="p">+</span> <span class="n">c</span><span class="p">]</span> <span class="p">=</span> <span class="n">tmp</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">scale</span><span class="p">(</span><span class="n">r</span> <span class="p">:</span><span class="n">UInt</span><span class="p">,</span> <span class="n">f</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">offset</span> <span class="p">=</span> <span class="p">(</span><span class="n">r</span> <span class="p">*</span> <span class="n">n</span><span class="p">).</span><span class="n">toInt</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">c</span> <span class="k">in</span> <span class="m">0</span> <span class="n">until</span> <span class="n">n</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="n">cs</span><span class="p">[</span><span class="n">offset</span> <span class="p">+</span> <span class="n">c</span><span class="p">]</span> <span class="o">*=</span> <span class="n">f</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">add</span><span class="p">(</span><span class="n">r0</span> <span class="p">:</span><span class="n">UInt</span><span class="p">,</span> <span class="n">r</span> <span class="p">:</span><span class="n">UInt</span><span class="p">,</span> <span class="n">f</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">offset0</span> <span class="p">=</span> <span class="p">(</span><span class="n">r0</span> <span class="p">*</span> <span class="n">n</span><span class="p">).</span><span class="n">toInt</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">offset</span> <span class="p">=</span> <span class="p">(</span><span class="n">r</span> <span class="p">*</span> <span class="n">n</span><span class="p">).</span><span class="n">toInt</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">c</span> <span class="k">in</span> <span class="m">0</span> <span class="n">until</span> <span class="n">n</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="n">cs</span><span class="p">[</span><span class="n">offset</span> <span class="p">+</span><span class="n">c</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cs</span><span class="p">[</span><span class="n">offset0</span> <span class="p">+</span><span class="n">c</span><span class="p">]</span> <span class="p">*</span> <span class="n">f</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">operator</span> <span class="k">fun</span> <span class="nf">times</span><span class="p">(</span><span class="n">f</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">=</span> <span class="n">RMatrix</span><span class="p">(</span><span class="n">cs</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">c</span> <span class="o">-&gt;</span> <span class="n">c</span> <span class="p">*</span> <span class="n">f</span> <span class="p">}.</span><span class="n">toDoubleArray</span><span class="p">(),</span> <span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">transpose</span><span class="p">()</span> <span class="p">=</span> <span class="n">RMatrix</span><span class="p">((</span><span class="m">0u</span> <span class="n">until</span> <span class="n">n</span><span class="p">).</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">c</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="m">0u</span> <span class="n">until</span> <span class="n">m</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">r</span> <span class="o">-&gt;</span> <span class="k">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="p">}</span> <span class="p">}.</span><span class="n">toTypedArray</span><span class="p">(),</span> <span class="n">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">operator</span> <span class="k">fun</span> <span class="nf">times</span><span class="p">(</span><span class="n">f</span> <span class="p">:</span><span class="n">RMatrix</span><span class="p">)</span> <span class="p">:</span><span class="n">RMatrix</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">assert</span><span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">f</span><span class="p">.</span><span class="n">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">result</span> <span class="p">=</span> <span class="p">(</span><span class="m">0u</span> <span class="n">until</span> <span class="n">m</span><span class="p">).</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">r</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="m">0u</span> <span class="n">until</span> <span class="n">f</span><span class="p">.</span><span class="n">n</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">c</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="m">0u</span> <span class="n">until</span> <span class="n">n</span><span class="p">).</span><span class="n">toList</span><span class="p">().</span><span class="n">sumOf</span> <span class="p">{</span> <span class="n">k</span> <span class="o">-&gt;</span> <span class="k">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="p">*</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">RMatrix</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">toTypedArray</span><span class="p">(),</span> <span class="n">f</span><span class="p">.</span><span class="n">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">operator</span> <span class="k">fun</span> <span class="nf">times</span><span class="p">(</span><span class="n">ys</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">)</span> <span class="p">:</span><span class="n">DoubleArray</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">assert</span><span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">ys</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">toUInt</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="m">0u</span> <span class="n">until</span> <span class="n">m</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">r</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="m">0u</span> <span class="n">until</span> <span class="n">n</span><span class="p">).</span><span class="n">toList</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">sumOf</span> <span class="p">{</span> <span class="n">k</span> <span class="o">-&gt;</span> <span class="k">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="p">*</span> <span class="n">ys</span><span class="p">[</span><span class="n">k</span><span class="p">.</span><span class="n">toInt</span><span class="p">()]</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}.</span><span class="n">toDoubleArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">argmax</span><span class="p">(</span><span class="n">r0</span> <span class="p">:</span><span class="n">UInt</span><span class="p">,</span> <span class="n">c</span> <span class="p">:</span><span class="n">UInt</span><span class="p">,</span> <span class="n">f</span> <span class="p">:(</span><span class="n">Double</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Double</span><span class="p">)</span> <span class="p">:</span><span class="n">Pair</span><span class="p">&lt;</span><span class="n">UInt</span><span class="p">,</span> <span class="n">Double</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">var</span> <span class="py">result</span> <span class="p">=</span> <span class="n">r0</span>
</span></span><span class="line"><span class="cl">        <span class="k">var</span> <span class="py">m</span> <span class="p">=</span> <span class="n">f</span><span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">r</span> <span class="k">in</span> <span class="n">r0</span> <span class="p">+</span> <span class="m">1u</span> <span class="n">until</span> <span class="k">this</span><span class="p">.</span><span class="n">m</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">val</span> <span class="py">m1</span> <span class="p">=</span> <span class="n">f</span><span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="p">&lt;</span> <span class="n">m1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">result</span> <span class="p">=</span> <span class="n">r</span><span class="p">;</span> <span class="n">m</span> <span class="p">=</span> <span class="n">m1</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Pair</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">equals</span><span class="p">(</span><span class="n">other</span> <span class="p">:</span><span class="n">Any</span><span class="p">?)</span> <span class="p">:</span><span class="n">Boolean</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">===</span> <span class="n">other</span><span class="p">)</span> <span class="k">return</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">other</span> <span class="o">!is</span> <span class="n">RMatrix</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">!=</span> <span class="n">other</span><span class="p">.</span><span class="n">n</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="o">!=</span> <span class="n">other</span><span class="p">.</span><span class="n">m</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">cs</span> <span class="n">contentEquals</span> <span class="n">other</span><span class="p">.</span><span class="n">cs</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">hashCode</span><span class="p">()</span> <span class="p">=</span> <span class="m">2</span><span class="p">+</span> <span class="n">n</span><span class="p">.</span><span class="n">hashCode</span><span class="p">()</span> <span class="p">+</span><span class="m">31</span><span class="p">*</span> <span class="n">m</span><span class="p">.</span><span class="n">hashCode</span><span class="p">()</span> <span class="p">+</span><span class="m">997</span><span class="p">*</span> <span class="n">cs</span><span class="p">.</span><span class="n">contentHashCode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Der Gaußsche Algorithmus sieht jetzt wie folgt aus:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">object</span> <span class="nc">RLUFact</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">RMatrix</span><span class="p">.</span><span class="n">linSolve</span><span class="p">(</span><span class="n">ys</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">)</span> <span class="p">:</span><span class="n">DoubleArray</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">assert</span><span class="p">(</span><span class="n">m</span><span class="o">&gt;=</span><span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">m</span> <span class="p">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">pad</span><span class="p">=</span><span class="m">1u</span><span class="p">);</span>  <span class="n">m</span><span class="p">.</span><span class="n">paste</span><span class="p">(</span><span class="m">0u</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">m</span><span class="p">.</span><span class="n">gaussElim</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="n">n</span> <span class="n">until</span> <span class="k">this</span><span class="p">.</span><span class="n">m</span><span class="p">).</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">xr</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="n">assert</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">xr</span><span class="p">,</span> <span class="n">n</span><span class="p">])&lt;</span><span class="n">epsilon</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">m</span><span class="p">.</span><span class="n">backSubst</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">RMatrix</span><span class="p">.</span><span class="n">backSubst</span><span class="p">(</span><span class="n">n</span> <span class="p">:</span><span class="n">UInt</span><span class="p">)</span> <span class="p">:</span><span class="n">DoubleArray</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">c</span> <span class="k">in</span> <span class="p">(</span><span class="m">0u</span> <span class="n">until</span> <span class="n">n</span><span class="p">).</span><span class="n">reversed</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">abd</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">]-</span><span class="m">1.0</span><span class="p">)&gt;</span><span class="m">5</span><span class="p">*</span><span class="n">epsilon</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="n">SingularityException</span><span class="p">(</span><span class="s2">&#34;Coefficient Matrix is near singular.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="p">(</span><span class="n">r</span> <span class="k">in</span> <span class="m">0u</span> <span class="n">until</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">this</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="p">-</span><span class="k">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">result</span> <span class="p">=</span> <span class="p">(</span><span class="m">0u</span> <span class="n">until</span> <span class="n">n</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">r</span> <span class="o">-&gt;</span> <span class="k">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="n">toDoubleArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">RMatrix</span><span class="p">.</span><span class="n">gaussElim</span><span class="p">(</span><span class="n">n</span> <span class="p">:</span><span class="n">UInt</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">var</span> <span class="py">r</span> <span class="p">=</span> <span class="m">0u</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">c</span> <span class="k">in</span> <span class="m">0u</span> <span class="n">until</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">val</span> <span class="py">r1</span> <span class="p">=</span> <span class="n">argmax</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="n">abs</span><span class="p">(</span><span class="k">it</span><span class="p">)</span> <span class="p">}.</span><span class="n">first</span>
</span></span><span class="line"><span class="cl">            <span class="n">swap</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">val</span> <span class="py">d</span> <span class="p">=</span> <span class="k">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">d</span><span class="p">)&lt;</span><span class="n">epsilon</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">println</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="n">SinguarityException</span><span class="p">(</span><span class="s2">&#34;Got down to </span><span class="si">${c + 1u}</span><span class="s2"> of </span><span class="si">$n</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">scale</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">.</span><span class="n">inv</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="p">(</span><span class="n">r2</span> <span class="k">in</span> <span class="n">r</span><span class="p">+</span><span class="m">1u</span> <span class="n">until</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="p">-</span><span class="k">get</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">r</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Jetzt ist auch klar, wozu wir einige der Zusatzfunktionen benötigen, <code>argmax</code> liefert die Zeile, in der der betragsgrößte Wert steht, <code>copy(pad :UInt)</code> kopiert die Matrix (wenn man sie verändern will, aber das Original aufheben muss) und fügt zusätzlich leere Spalten hinten an.</p>
<p>Jetzt können wir die Interpolation schreiben:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">import</span> <span class="nn">common.math.RLUFact.linSolve</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">data</span> <span class="k">class</span> <span class="nc">Interpolate</span><span class="p">(</span><span class="k">val</span> <span class="py">xs</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">,</span> <span class="k">val</span> <span class="py">cs</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">)</span> <span class="p">:(</span><span class="n">Double</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Double</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">fun</span> <span class="nf">of</span><span class="p">(</span><span class="n">xs</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">,</span> <span class="n">ys</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">)</span> <span class="p">=</span> <span class="n">Interpolate</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">createVanDerMonde</span><span class="p">(</span><span class="n">xs</span><span class="p">).</span><span class="n">linSolve</span><span class="p">(</span><span class="n">ys</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">fun</span> <span class="nf">createVanDerMonde</span><span class="p">(</span><span class="n">xs</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">)</span> <span class="p">:</span><span class="n">RMatrix</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">n</span> <span class="p">=</span> <span class="n">xs</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">toUInt</span><span class="p">()</span> <span class="p">-</span><span class="m">1u</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">cs</span> <span class="p">=</span> <span class="n">xs</span><span class="p">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="k">var</span> <span class="py">p</span> <span class="p">=</span> <span class="m">1.0</span>
</span></span><span class="line"><span class="cl">          <span class="n">listOf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">+(</span><span class="m">1u</span><span class="o">..</span><span class="n">n</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">p</span> <span class="o">*=</span> <span class="n">x</span><span class="p">;</span> <span class="n">p</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">RMatrix</span><span class="p">(</span><span class="n">cs</span><span class="p">.</span><span class="n">toDoubleArray</span><span class="p">(),</span> <span class="n">n</span><span class="p">+</span><span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="n">toString</span><span class="p">()</span> <span class="p">=</span> <span class="n">cs</span><span class="p">.</span><span class="n">toString</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">apply</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">=</span> <span class="n">cs</span><span class="p">.</span><span class="n">foldRight</span><span class="p">(</span><span class="m">0.0</span><span class="p">)</span> <span class="p">{</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="n">s</span><span class="p">*</span><span class="n">x</span><span class="p">+</span><span class="n">c</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Die Berechnung des Polynoms erfolgt nach dem Horner-Schema, d.h. wir berechnen
$$ p(x) = c_0+c_1x+c_2x^2+\dots+c_nx^n$$
gemäß der Formel
$$ p(x) = (((c_n * x+c_{n-1}) * x+c_{n-2}) * \dots) * x +c_0. $$</p>
<p>Schließlich sollten wir die Interpolation testen, z.B. an der gegebenen Funktion.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">n</span> <span class="p">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">domain</span> <span class="p">=</span> <span class="n">DoubleRange</span><span class="p">(-</span><span class="m">2.0</span><span class="p">,</span> <span class="m">2.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">f</span> <span class="p">=</span> <span class="n">DescribedFunction</span><span class="p">(</span><span class="s2">&#34;1/(1+x^2)&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="m">1</span><span class="p">/(</span><span class="m">1</span><span class="p">+</span><span class="n">x</span><span class="p">*</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">interpol</span> <span class="p">=</span> <span class="n">DescribedFunction</span><span class="p">(</span><span class="s2">&#34;interpolation&#34;</span><span class="p">,</span> <span class="nc">Interpolate</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">f</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="n">xs</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">println</span><span class="p">(</span><span class="n">interpol</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">error</span> <span class="p">=</span> <span class="n">DescribedFunction</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">interpol</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)-</span><span class="n">f</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">window</span> <span class="p">=</span> <span class="n">MyWindow</span><span class="p">(</span><span class="n">Plotter</span><span class="p">(</span><span class="n">listOf</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">interpol</span><span class="p">,</span> <span class="n">error</span><span class="p">),</span> <span class="n">domain</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Im Bild solltest du 3 Graphen sehen: schwarz die original Funktion ($1/(1+x^2)$), in blau die Interpolation und in grün den Fehler.</p>
<p>Man sieht, dass sich der schwarze und der blaue Graph in 3 Punkten schneiden, nämlich bei $x\in \{-1,0,1\}$.  Das ist auch sinnvoll, weil die Interpolation durch diese 3 Punkte gehen sollte.  Man sieht weiterhin, dass die Interpolation etwas ähnlich zur original-Funktion ist, d.h. bei $x=0$ geht sie durch $y=1$, danach konkav nach unten.  Leider passt die Interpolation außerhalb des Bereiches $(-1,1)$ ziemlich schlecht.  Das liegt unter anderem daran, dass das außerhalb des Interpolationsbereiches ist.  Man spricht auch von Extrapolation.</p>
<p>Wird das nun besser, wenn man mehr Stützstellen verwendet?</p>
<p>Dazu ändern wir das Hauptprogramm wie folgt ab:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">n</span> <span class="p">=</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">xs</span> <span class="p">=</span> <span class="p">(-</span><span class="n">n</span><span class="o">..</span><span class="n">n</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span><span class="p">.</span><span class="n">toDouble</span><span class="p">()*</span><span class="m">2</span><span class="p">/</span><span class="n">n</span> <span class="p">}.</span><span class="n">toDoubleArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Jetzt schneiden sich die Kurven 5mal, denn wir haben 5 Stützstellen.  Außerdem läuft die Interpolation nicht mehr soweit aus dem Ruder.  Das liegt daran, dass wir nicht mehr extrapolieren.</p>
<p>Vielleicht können wir den Funktionenplotter noch verbessern, indem wir die Stützpunkte einzeichnen.  Das kann man wie folgt erreichen:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">class</span> <span class="nc">Plotter</span><span class="p">(</span><span class="k">val</span> <span class="py">fs</span> <span class="p">:</span><span class="n">List</span><span class="p">&lt;</span><span class="n">DescribedFunction</span><span class="p">&gt;,</span> <span class="k">val</span> <span class="py">domain</span> <span class="p">:</span><span class="n">DoubleRange</span><span class="p">,</span> <span class="k">val</span> <span class="py">ps</span> <span class="p">:</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Pair</span><span class="p">&lt;</span><span class="n">Double</span><span class="p">,</span> <span class="n">Double</span><span class="p">&gt;&gt;</span> <span class="p">=</span><span class="n">emptyList</span><span class="p">())</span> <span class="p">:</span><span class="n">JComponent</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">Graphics</span><span class="p">.</span><span class="n">plotCruves</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">      <span class="n">color</span> <span class="p">=</span> <span class="nc">Color</span><span class="p">.</span><span class="n">RED</span>
</span></span><span class="line"><span class="cl">      <span class="n">ps</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="n">fillOval</span><span class="p">(</span><span class="n">scale</span><span class="p">.</span><span class="n">px</span><span class="p">(</span><span class="n">x</span><span class="p">)-</span><span class="m">2</span><span class="p">,</span> <span class="n">scale</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="n">y</span><span class="p">)-</span><span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span><span class="m">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Die Änderung bewirkt, dass die übergebenen Punkte in rot gemalt werden (als kleine Kreise mit Durchmesser 5).</p>
<p>Dazu müssen wir noch das Hauptprogramm anpassen:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">f</span> <span class="p">=</span> <span class="nc">Described</span><span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">ys</span> <span class="p">=</span> <span class="n">f</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">interpol</span> <span class="p">=</span> <span class="n">DescribedFunction</span><span class="p">(</span><span class="s2">&#34;interpolation&#34;</span><span class="p">,</span> <span class="nc">Interpolate</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">window</span> <span class="p">=</span> <span class="n">MyWindow</span><span class="p">(</span><span class="n">Plotter</span><span class="p">(</span><span class="n">listOf</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">interpol</span><span class="p">,</span> <span class="n">error</span><span class="p">),</span> <span class="n">domain</span><span class="p">,</span> <span class="n">xs</span><span class="p">.</span><span class="n">zip</span><span class="p">(</span><span class="n">ys</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Wenn du das Programm wieder startest, solltest du neben den 3 Kurven noch die 5 roten Punkte sehen, in denen sich die Kurven schneiden.</p>
<p><img src="/img/interpol5.png" alt="Interpolation an 5 Stützstellen. CC M. Grützmann 2023">
Bild 3: Interpolation an 5 Stützstellen. CC M. Grützmann 2023.</p>
<p>Wird die Interpolation nun besser, wenn man mehr Stützstellen verwendet?</p>
<p>Im Prinzip ja, aber das sollten wir testen:  Dazu im Hauptprogramm folgendes anpassen:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">n</span> <span class="p">=</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">xs</span> <span class="p">=</span> <span class="p">(-</span><span class="n">n</span><span class="o">..</span><span class="n">n</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span><span class="p">.</span><span class="n">toDouble</span><span class="p">()*</span><span class="m">2</span><span class="p">/</span><span class="n">n</span> <span class="p">}.</span><span class="n">toDoubleArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Das sollte zwei Kurven mit 7 Schnittpunkten produzieren (wieder im Bereich $(-2,2)$).  Andererseits kommt es bereits zu kleinen Ausbeulungen, so als ob das Polynom nicht ganz an die Originalfunktion &lsquo;ranpasst.</p>
<p><img src="/img/interpol7.png" alt="Interpolation an 7 und an 11 Stützstellen. CC M. Grützmann 2023">
Bild 4: Interpolation an 7 und an 11 Stützstellen.  Die Fehler in der Mitte werden kleiner, aber der Fehler an den Rändern ändert sich wenig. CC M. Grützmann 2023.</p>
<p>Um auch quantitativ zu erkennen, wie gut die Interpolation ist, können wir die Wurzel aus der mittleren quadratischen Abweichung berechnen (RMSE), etwa wie folgt:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">rmse</span><span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="n">DescribedFunction</span><span class="p">,</span> <span class="n">domain</span> <span class="p">:</span><span class="n">DoubleRange</span><span class="p">,</span> <span class="n">n</span> <span class="p">:</span><span class="n">UInt</span> <span class="p">=</span><span class="m">1000u</span><span class="p">)</span> <span class="p">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="n">partitition</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="n">sumOf</span> <span class="p">{</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="p">*</span><span class="n">x</span> <span class="p">}/</span><span class="n">n</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Die muss man dann im Hauptprogramm aufrufen, um das Ergebnis zu sehen:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">error</span> <span class="p">=</span> <span class="n">DescribedFunction</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">rmse</span> <span class="p">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">println</span><span class="p">(</span><span class="s2">&#34;Der mittlere Fehler bei der Interpolation beträgt </span><span class="si">$rmse</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">window</span> <span class="p">=</span> <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Wenn du das Programm neu startest, dann sollte in der Konsole als letzte Zeile der &ldquo;mittlere Fehler der Interpolation&rdquo; ausgegeben werden.  Der Wert ist wahrscheinlich etwa so groß, wie die größte Abweichung an den Rändern.  Wenn du das Programm für verschiedene Anzahl Stützstellen ausführst, sollte der RMSE tendentiell kleiner werden.</p>
<p>Wenn du jetzt <code>n</code> weiter erhöhst, können 2 Dinge passieren:  Es funktioniert und du erhältst mehr Schnittpunkte.  Oder es gibt Rechenfehler, die zu schlechteren Approximationen führen oder schließlich sogar zum Versagen der Berechnung der Interpolation (<code>SingularityException</code>).</p>
<h1 id="4-eine-idee-von-bézier-und-casteljau">4. Eine Idee von Bézier und Casteljau</h1>
<p>Die Interpolation hat 3 Probleme:</p>
<ul>
<li>Zum einen wird die Berechnung immer komplexer (die van der Monde Matrix wird immer größer);</li>
<li>Es treten immer größere Rechenfehler auf;</li>
<li>Die Polynome können leicht überschwingen, also große Abweichungen produzieren, obwohl die Stützpunkte immer dichter zusammen rücken.</li>
</ul>
<p>Stattdessen hatten Pierre Bézier und Paul de Casteljau in den 1960ern eine andere Idee.  Statt 1 Polynom zu verwenden, verwendeten sie eine Reihe von Polynomen, die jeweils in einem Interval zwischen benachbarten Stützstellen gelten.  Damit das ganze eine glatte Kurve ergibt, verlangten sie, dass an den Übergangsstellen nicht nur der vorgegebene Funktionswert eingehalten wurde (die Kurve stetig war), sodern auch die 1. und die 2. Ableitung stetig sein sollte.</p>
<p>Wenn man $n+1$ Stützpunkte hat, gibt es $n$ Intervalle, und in jedem dieser Intervalle ein Polynom von Grad 3 (sodass an beiden Enden die 2. Ableitung verschieden sein kann). Man hat also $4n$ unbekannte Koeffizienten und fordert $4n-3$ Bedingungen:</p>
<p>$$\begin{array}{rl}
b^3_0(x_0) &amp;= y_0, \\
b^3_0(x_1) &amp;= y_1, \\
b^\prime_0(x_1) &amp;= b^\prime_1(x_1), \\
b^\prime{}^\prime_0(x_1) &amp;= b^\prime{}^\prime_1(x_1), \\\hline
b^3_1(x_1) &amp;= y_1, \\
b^3_1(x_2) &amp;= y_2, \\
b^\prime_1(x_2) &amp;= b^\prime_2(x_2), \\
b^\prime{}^\prime_1(x_2) &amp;= b^\prime{}^\prime_2(x_2), \\\hline
&amp;\vdots \\
b^3_{n-1}(x_n) &amp;= y_n.
\end{array}$$</p>
<p>Dazu müsste man jetzt fleißig sein und aus $b^3_i(x)= a_{i,0}+a_{i,1}x+a_{i,2}x^2+a_{i,3}x^3$ die Ableitung ausrechnen und dann das entsprechende Gleichungssystem aufstellen.  Aber selbst wenn man das alles fehlerfrei macht, wird das Gleichungssystem am Ende keine eindeutige Lösung haben, weil es eben $4n$ Koeffizienten aber nur $4n-3$ Gleichungen sind.</p>
<p>Stattdessen hatte Bézier eine bessere Idee, wie man das Gleichungssystem systematisch aufschreiben kann:  Wir definieren der Reihe nach Interpolationsfunktionen für den Grad 0, 1, 2 und 3 wie folgt:</p>
<p>$$ b^0_i(x) = \theta(x-x_i) -\theta(x-x_{i+1}) = \begin{cases} 1&amp;\text{für } x_i\le x&lt; x_{i+1},\\ 0&amp;\text{sonst.} \end{cases} $$
$$ b^k_i(x) = \omega^k _ i(x)b^{k-1} _ i(x) +\left(1-\omega^k _ {i+1}(x)\right)b^{k-1} _ {i+1}(x) $$
$$\text{mit}\quad\omega^k_i(x) = \begin{cases} \frac{x-x_i}{x_{i+k}-x_i} &amp;\text{für } x_i\ne x_{i+k}, \\ 0&amp;\text{sonst.} \end{cases} $$</p>
<p>Die Funktionen $b^k_i(x)$ sind stückweise $k$-fach stetig, also $b^0_i(x)$ stückweise stetig (und stückweise konstant), $b^1_i(x)$ stückweise stetig differenzierbar, $b^2_i(x)$ stückweise 2-fach stetig differenzierbar und $b^3_i(x)$ stückweise 3-fach stetig differenzierbar.  Da $b^k_i(x)$ stückweise $k$-fachs stetig differenzierbar ist, ist es insbesondere $k-1$-fach stetig differenzierbar.</p>
<p>Wenn wir bis zum Grad 3 gehen wollen, dann gibt es $n+4$ solche Funktionen &ndash; $\mathbf b^3(x) = (b^3_{-3}(x),b^3 _ {-2}(x),\dots,b^3_n(x))^T$.  Diese Funktionen erfüllen aber noch eine Zusatzbedingung
$$ \sum_{i=-k}^n b^k_i(x) \equiv 1\text{ für } x_0\le x&lt; x_n. $$</p>
<p>Um diese Funktionen besser zu verstehen, wollen wir sie zunächst plotten.  Dazu schreiben wir folgende Klasse:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">data</span> <span class="k">class</span> <span class="nc">Bspline</span><span class="p">(</span><span class="k">val</span> <span class="py">xs</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">,</span> <span class="k">val</span> <span class="py">deg</span> <span class="p">:</span><span class="n">UByte</span> <span class="p">=</span><span class="m">3u</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">fun</span> <span class="nf">theta</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">=</span> <span class="k">when</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span><span class="o">&gt;=</span><span class="m">0</span> <span class="o">-&gt;</span> <span class="m">1.0</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="o">-&gt;</span> <span class="m">0.0</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">init</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">assert</span><span class="p">(</span><span class="n">xs</span><span class="p">.</span><span class="n">size</span><span class="p">&gt;</span><span class="n">deg</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">DoubleArray</span><span class="p">.</span><span class="n">pick</span><span class="p">(</span><span class="n">i</span> <span class="p">:</span><span class="n">Int</span><span class="p">)</span> <span class="p">=</span> <span class="k">get</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">size</span><span class="p">-</span><span class="m">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">omega</span><span class="p">(</span><span class="n">i</span> <span class="p">:</span><span class="n">Int</span><span class="p">,</span> <span class="n">k</span> <span class="p">:</span><span class="n">UByte</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">=</span> <span class="k">when</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">xs</span><span class="p">.</span><span class="n">pick</span><span class="p">(</span><span class="n">i</span><span class="p">+</span><span class="n">k</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span> <span class="p">&gt;</span> <span class="n">xs</span><span class="p">.</span><span class="n">pick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">x</span><span class="p">-</span><span class="n">xs</span><span class="p">.</span><span class="n">pick</span><span class="p">(</span><span class="n">i</span><span class="p">))/(</span><span class="n">xs</span><span class="p">.</span><span class="n">pick</span><span class="p">(</span><span class="n">i</span><span class="p">+</span><span class="n">k</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span> <span class="p">-</span><span class="n">xs</span><span class="p">.</span><span class="n">pick</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span> <span class="o">-&gt;</span> <span class="m">0.0</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">b</span><span class="p">(</span><span class="n">i</span> <span class="p">:</span><span class="n">Int</span><span class="p">,</span> <span class="n">k</span> <span class="p">:</span><span class="n">UByte</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">:</span><span class="n">Double</span> <span class="p">=</span> <span class="k">when</span><span class="p">(</span><span class="n">k</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="m">0</span> <span class="o">-&gt;</span> <span class="n">theta</span><span class="p">(</span><span class="n">x</span><span class="p">-</span><span class="n">xs</span><span class="p">.</span><span class="n">pick</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="p">-</span><span class="n">theta</span><span class="p">(</span><span class="n">x</span><span class="p">-</span><span class="n">xs</span><span class="p">.</span><span class="n">pick</span><span class="p">(</span><span class="n">i</span><span class="p">+</span><span class="m">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span> <span class="o">-&gt;</span> <span class="n">omega</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">)*</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">-</span><span class="m">1u</span><span class="p">).</span><span class="n">toUByte</span><span class="p">(),</span> <span class="n">x</span><span class="p">)</span> <span class="p">+(</span><span class="m">1</span><span class="p">-</span><span class="n">omega</span><span class="p">(</span><span class="n">i</span><span class="p">+</span><span class="m">1</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">))*</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">+</span><span class="m">1</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">-</span><span class="m">1u</span><span class="p">).</span><span class="n">toUByte</span><span class="p">(),</span> <span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">b</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="n">k</span> <span class="p">:</span><span class="n">UByte</span> <span class="p">=</span><span class="n">deg</span><span class="p">)</span> <span class="p">=</span> <span class="p">(-</span><span class="n">k</span><span class="p">.</span><span class="n">toInt</span><span class="p">()</span> <span class="n">until</span> <span class="n">xs</span><span class="p">.</span><span class="n">size</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">}.</span><span class="n">toDoubleArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Zusammen mit dem Hauptprogramm:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">n</span> <span class="p">=</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">xs</span> <span class="p">=</span> <span class="p">(-</span><span class="n">n</span><span class="o">..</span><span class="n">n</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span><span class="p">.</span><span class="n">toDouble</span><span class="p">()/</span><span class="n">n</span> <span class="p">}.</span><span class="n">toDoubleArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">domain</span> <span class="p">=</span> <span class="n">DoubleRange</span><span class="p">(-</span><span class="m">1.0</span><span class="p">,</span> <span class="m">1.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">k</span> <span class="p">=</span> <span class="m">3.</span><span class="n">toUByte</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">splines</span> <span class="p">=</span> <span class="n">Bspline</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">bs</span> <span class="p">=</span> <span class="p">(</span><span class="m">0</span> <span class="n">until</span> <span class="p">(</span><span class="n">splines</span><span class="p">.</span><span class="n">b</span><span class="p">(</span><span class="m">0.0</span><span class="p">).</span><span class="n">size</span><span class="p">)).</span><span class="n">map</span> <span class="p">{</span> <span class="n">i</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">DescribedFunction</span><span class="p">(</span><span class="s2">&#34;b^{k}_</span><span class="si">${i-k}</span><span class="s2">(x)&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">spline</span><span class="p">.</span><span class="n">b</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="p">+</span> <span class="n">listOf</span><span class="p">(</span><span class="n">DescribedFunction</span><span class="p">(</span><span class="s2">&#34;sum&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">spline</span><span class="p">.</span><span class="n">b</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">sum</span><span class="p">()</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">window</span> <span class="p">=</span> <span class="n">MyWindow</span><span class="p">(</span><span class="n">Plotter</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">domain</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">windows</span><span class="p">.</span><span class="n">isVisible</span> <span class="p">=</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Dann ergibt sich folgendes Bild:</p>
<p><img src="/img/BKsupportFunctions.png" alt="Stützfunktionen nach Casteljau. CC M. Grützmann 2023">
Bild 5: Stützfunktionen nach Casteljau. CC M. Grützmann 2023.</p>
<h1 id="5-berechnung-der-koeffizienten">5. Berechnung der Koeffizienten</h1>
<p>Das eigentliche Problem ist die Berechnung der Bézier-Koeffizienten.  Dazu entnehmen wir aus [3] folgende Formeln:</p>
<p>$$ f(x) = \mathbf b(x)\cdot \mathbf c,\quad \mathbf c = G^{-1}X\mathbf{y}, $$
$$ G = XX^T,\quad X = (\mathbf b(x_0),\dots,\mathbf b(x_n)). $$</p>
<p>D.h. dass wir ein lineares Gleichungssystem $G\mathbf c= X\mathbf y$ nach den Koeffizienten $\mathbf c$ auflösen müssen.  Der Vorteil von diesem Gleichungssystem ist, dass die Koeffizientenmatrix $G$ symmetrisch und positiv semi-definit ist.</p>
<p>Wir können zunächst versuchen, dass Gleichungssystem mit dem Gauß-Algorithmus zu lösen.  Dazu implementieren wir also folgende zusätzlichen Funktionen:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">import</span> <span class="nn">common.math.LUFact.linSolve</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">data</span> <span class="k">class</span> <span class="nc">Bspline</span><span class="p">(</span><span class="k">val</span> <span class="py">xs</span> <span class="p">:</span><span class="o">..</span><span class="p">.)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">b</span><span class="p">()</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">xs</span><span class="p">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">b</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}.</span><span class="n">toDoubleArray</span><span class="p">(),</span> <span class="n">b</span><span class="p">(</span><span class="m">0.0</span><span class="p">).</span><span class="n">size</span><span class="p">.</span><span class="n">toUInt</span><span class="p">()).</span><span class="n">transpose</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">fit</span><span class="p">(</span><span class="n">ys</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">)</span> <span class="p">:</span><span class="n">Fit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">assert</span> <span class="p">(</span><span class="n">xs</span><span class="p">.</span><span class="n">size</span><span class="o">==</span><span class="n">ys</span><span class="p">.</span><span class="n">size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">x</span> <span class="p">=</span> <span class="n">b</span><span class="p">();</span>  <span class="n">println</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>  <span class="n">println</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">xy</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">times</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">g</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">timesT</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>  <span class="n">println</span><span class="p">(</span><span class="n">g</span><span class="p">);</span>  <span class="n">println</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">Fit</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">linSolve</span><span class="p">(</span><span class="n">xy</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">data</span> <span class="k">class</span> <span class="nc">Fit</span><span class="p">(</span><span class="n">s</span> <span class="p">:</span><span class="n">Bspline</span><span class="p">,</span> <span class="n">cs</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">)</span> <span class="p">:(</span><span class="n">Double</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Double</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">xs</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="n">xs</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">invoke</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span><span class="n">Dobule</span><span class="p">)</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="n">b</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">dot</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">data</span> <span class="k">class</span> <span class="nc">RMatrix</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">      <span class="k">fun</span> <span class="nf">timesT</span><span class="p">(</span><span class="n">f</span> <span class="p">:</span><span class="n">RMatrix</span><span class="p">)</span> <span class="p">:</span><span class="n">RMatrix</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">assert</span><span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">f</span><span class="p">.</span><span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="n">Matrix</span><span class="p">((</span><span class="m">0u</span> <span class="n">until</span> <span class="n">m</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">r</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="m">0u</span> <span class="n">until</span> <span class="n">f</span><span class="p">.</span><span class="n">m</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">c</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">(</span><span class="m">0u</span> <span class="n">until</span> <span class="n">n</span><span class="p">).</span><span class="n">sumOf</span> <span class="p">{</span> <span class="n">k</span> <span class="o">-&gt;</span> <span class="k">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="p">*</span> <span class="n">ys</span><span class="p">[</span><span class="n">k</span><span class="p">.</span><span class="n">toInt</span><span class="p">()]</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}.</span><span class="n">toDoubleArray</span><span class="p">(),</span> <span class="n">f</span><span class="p">.</span><span class="n">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Die Matrix-Multiplikation <code>fun timesT(f :RMatrix)</code> berechnet das Produkt 2er Matrizen.  Im Unterschied zu <code>operator fun times(f :RMatrix)</code> geht aber die 2. Matrix transponiert ein.</p>
<p>Diese Funktionen ruft man wie folgt auf:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">f</span> <span class="p">=</span> <span class="n">DescribedFunction</span><span class="p">(</span><span class="s2">&#34;1/(1+x^2)&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="m">1</span><span class="p">/(</span><span class="m">1</span><span class="p">+</span><span class="n">x</span><span class="p">*</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">ys</span> <span class="p">=</span> <span class="n">f</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">fit</span> <span class="p">=</span> <span class="n">DescribedFunction</span><span class="p">(</span><span class="s2">&#34;spline&#34;</span><span class="p">,</span> <span class="n">splines</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">ys</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">error</span> <span class="p">=</span> <span class="n">DescribedFunction</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">fit</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">-</span><span class="n">f</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">window</span> <span class="p">=</span> <span class="n">MyWindow</span><span class="p">(</span><span class="n">Plotter</span><span class="p">(</span><span class="n">listOf</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fit</span><span class="p">,</span> <span class="n">error</span><span class="p">),</span> <span class="n">domain</span><span class="p">,</span> <span class="n">xs</span><span class="p">.</span><span class="n">zip</span><span class="p">(</span><span class="n">ys</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">window</span><span class="p">.</span><span class="n">isVisible</span> <span class="p">=</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Leider funktioniert das nicht, sondern stürzt mit <code>SingularityException</code> ab.  Dafür gibt es 2 Gründe:  Zum einen ist das Gleichungssystem unterbestimmt.  Aus der Fehlermeldung sieht man, dass der Löser bis zur Zeile &ldquo;5 von 7&rdquo; kommt, d.h. dass 2 Koeffizienten überflüssig sind und wir entsprechend 2 Stützfunktionen weglassen sollten.  Zum anderen kann es gut sein, dass der Gaußsche Algorithmus nicht die stabilste Methode ist, das Gleichungssystem zu lösen.</p>
<p>Ein Blick auf Bild 5 zeigt, dass wir zwar die Funktionen $b^3 _ {-3}(x)$ und $b^3_3(x)$ brauchen (um den Anfangs- und Endpunkt zu erreichen), aber $b^3 _ {-2}(x)$ und $b^3_2(x)$ ihr Maximum zwischen zwei Stützstellen haben.  Deshalb lassen wir die einfach weg.  Dazu modifizieren wir die Methoden <code>fun b(x :Double, k :UByte =deg)</code> und <code>fun b() :Matrix</code> wie folgt:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">b</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="n">k</span> <span class="p">:</span><span class="n">UByte</span> <span class="p">=</span><span class="n">deg</span><span class="p">)</span> <span class="p">:</span><span class="n">DoubleArray</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">indices</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">k</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="m">1</span> <span class="o">-&gt;</span> <span class="m">0</span> <span class="n">until</span> <span class="n">xs</span><span class="p">.</span><span class="n">size</span><span class="p">-</span><span class="m">2</span>
</span></span><span class="line"><span class="cl">      <span class="m">2</span> <span class="o">-&gt;</span> <span class="m">0</span> <span class="n">until</span> <span class="n">xs</span><span class="p">.</span><span class="n">size</span> <span class="p">-</span><span class="m">2</span>
</span></span><span class="line"><span class="cl">      <span class="m">3</span> <span class="o">-&gt;</span> <span class="p">-</span><span class="m">1</span> <span class="n">until</span> <span class="n">xs</span><span class="p">.</span><span class="n">size</span> <span class="p">-</span><span class="m">3</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span> <span class="o">-&gt;</span> <span class="n">TODO</span><span class="p">(</span><span class="s2">&#34;unimplemented&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">cs</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="n">b</span><span class="p">(-</span><span class="n">k</span><span class="p">.</span><span class="n">toInt</span><span class="p">(),</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="p">+</span> <span class="n">indices</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">}</span> <span class="p">+</span><span class="n">listOf</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">xs</span><span class="p">.</span><span class="n">size</span><span class="p">-</span><span class="m">2</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">cs</span><span class="p">.</span><span class="n">toDoubleArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">b</span><span class="p">()</span> <span class="p">:</span><span class="n">Matrix</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">n</span> <span class="p">=</span> <span class="n">xs</span><span class="p">.</span><span class="n">size</span><span class="p">-</span><span class="m">2</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">cs</span> <span class="p">=</span> <span class="n">xs</span><span class="p">.</span><span class="n">subList</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">xs</span><span class="p">.</span><span class="n">size</span><span class="p">-</span><span class="m">1</span><span class="p">).</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">b</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span> <span class="p">+(</span><span class="n">DoubleArray</span><span class="p">(</span><span class="n">n</span><span class="p">-</span><span class="m">1</span><span class="p">){</span><span class="m">0.0</span><span class="p">}.</span><span class="n">toList</span><span class="p">()+</span><span class="n">listOf</span><span class="p">(</span><span class="m">1.0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">cs</span><span class="p">.</span><span class="n">toDoubleArray</span><span class="p">(),</span> <span class="n">n</span><span class="p">).</span><span class="n">transpose</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Der Grund für die Modifikation von <code>fun b() :Matrix</code> ist, dass die Funktionen <code>b(x)</code> am rechten Rand alle bereits 0 werden, wir aber in der letzten Spalte der Matrix die Summe 1 brauchen.</p>
<p>Damit und mit dem letzten Hauptprogramm sollte es jetzt erst einmal klappen, d.h. du erhältst ein Ergebnis ähnlich zu Bild 2.</p>
<h1 id="9-selber-experimentieren">9. Selber Experimentieren</h1>
<p>Jetzt ist Zeit, das Programm ausgiebig zu testen.  Dazu kannst du sowohl die Zielfunktion ändern als auch die Anzahl der Stützstellen, oder sogar einfach ein paar Funktionswerte vorgeben.</p>
<p>Vielleicht kannst du dich mit oszillierenden Funktionen probieren:  Das typische Beispiel ist die Sinus-Funktion <code>fun sin(x :Double) :Double</code>, die du aus dem Paket &ldquo;kotlin.math&rdquo; importieren kannst.  Die Funktion beginnt bei $\sin 0 = 0$ und wiederholt sich alle $2\pi\approx 6.28$  Die Zahl $\pi$ spricht man pi aus und kann man als Konstante <code>PI</code> ebenfalls aus &ldquo;kotlin.math&rdquo; importieren.  Du kannst ja damit anfangen, die Funktion zwischen 0 und $2\pi$ mit 5 Stützstellen zu interpolieren (entweder exakt oder mit Bézierkurven).  Dann könntest du auch einfach $4n+1$ Stützpunkte vorgeben, nach dem Prinzip <code>val xs = (0..4*n).map { k -&gt; PI*k/2 }.toDoubleArray()</code> und <code>val ys = doubleArrayOf(0.0,1.0,0.0,-1.0, 0.0,1.0,0.0,-1.0, ..., 0.0)</code> und schauen, wir gut die Interpolation klappt.  Bevor zu aber 13 Stützpunkte angibst, solltest du es erst einmal mit 5 Stützpunkten probieren.  Der Grund ist, dass der Gaußsche Algorithmus nicht beliebig genau ist, die Bézierkurven eventuell instabil werden.</p>
<h2 id="92-numerische-bibliothek-verwenden">9.2 Numerische Bibliothek Verwenden</h2>
<p>Wenn du die Interpolation/Bézierkurven weiter treiben willst, könntest du versuchen, eine numerische Bibliothek zum Lösen des linearen Gleichungssystems zu verwenden.  Dazu müsstest du die &ldquo;build.gradle.kts&rdquo; zunächst anpassen.  Eine interessante Bibliothek, die in der JVM funktioniert, wäre &ldquo;org.ojalgo:ojalgo&rdquo;, die zum Zeitpunkt des Schreibens in der Version &ldquo;52.0.1&rdquo; vorliegt.  Dazu müsstest du die Datei &ldquo;build.gradle.kts&rdquo; im Hauptordner des Programms wie folgt anpassen:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Kotlin" data-lang="Kotlin"><span class="line"><span class="cl"><span class="n">dependencies</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">implementation</span><span class="p">(</span><span class="s2">&#34;org.ojalgo:ojalgo:52.0.1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">testImplementation</span><span class="p">(</span><span class="n">kotlin</span><span class="p">(</span><span class="s2">&#34;test&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>d.h., wenn es den Block <code>dependencies {...}</code> schon gibt, solltest du schauen, dass er dann auch die Zeile <code>implementation(&quot;org....&quot;)</code> enthält.  Falls es den Block noch nicht gibt, kannst du den gesamten Inhalt irgendwo zwischen den anderen Blöcken anlegen (nicht zu weit vorne).  Eventuell musst du auch den Block</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="n">tasks</span><span class="p">.</span><span class="n">test</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">useJUnitPlatform</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>noch ergänzen.  Danach musst du die Datei neu importieren.  Dazu sollte nach dem Bearbeiten ein Symbol mit grauem Hintergrund, einem dunkelgrauen Elefant und 2 blauen Pfeilen, die im Kreis zeigen, auftauchen.  Entweder klickst du auf dieses Symbol (wenn du es siehst) oder du öffnest den &ldquo;Gradle&rdquo;-Reiter (am rechten oberen Rand) und klickst dort links-oben auf die 2 grauen Pfeile, die im Kreis zeigen.  Nach kurzem Import sollte das erste Symbol verschwinden.</p>
<p>Du musst dann entsprechend die 4 Methoden <code>fun b(x :Double, k :UByte =deg)</code>, <code>fun b() :Matrix</code>, <code>fun fit(ys :DoubleArray) :Fit</code> in <code>Bspline</code> und <code>fun Fit::apply(x :Double) :Double</code> anpassen, etwa wie folgt:</p>
<p>Die Klasse <code>Fit</code> muss auf Vektoren aus der Bibliothek umgestellt werden:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Kotlin" data-lang="Kotlin"><span class="line"><span class="cl">  <span class="k">data</span> <span class="k">class</span> <span class="nc">Fit</span><span class="p">(</span><span class="k">private</span> <span class="k">val</span> <span class="py">s</span> <span class="p">:</span><span class="n">Bspline</span><span class="p">,</span> <span class="k">val</span> <span class="py">cs</span> <span class="p">:</span><span class="n">MatrixStore</span><span class="p">&lt;</span><span class="n">Double</span><span class="p">&gt;)</span> <span class="p">:(</span><span class="n">Double</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Double</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">xs</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="n">xs</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">override</span> <span class="k">fun</span> <span class="nf">invoke</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span><span class="n">Double</span><span class="p">)</span> <span class="p">:</span><span class="n">Double</span> <span class="p">=</span> <span class="n">cs</span><span class="p">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">b</span><span class="p">(</span><span class="n">x</span><span class="p">))[</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Die Methode <code>fun fit(ys :DoubleArray) :Fit</code> ändert sich wie folgt:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">import</span> <span class="nn">org.ojalgo.matrix.store.Primitive64Store</span>
</span></span><span class="line"><span class="cl">  <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">data</span> <span class="k">class</span> <span class="nc">Bspline</span><span class="p">(</span><span class="k">val</span> <span class="py">xs</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">,</span> <span class="k">val</span> <span class="py">deg</span> <span class="p">:</span><span class="n">UByte</span> <span class="p">=</span><span class="m">2u</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">fun</span> <span class="nf">theta</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span> <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">mFactory</span> <span class="p">=</span> <span class="n">Primitive64Store</span><span class="p">.</span><span class="n">FACTORY</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">fit</span><span class="p">(</span><span class="n">ys</span> <span class="p">:</span><span class="n">DoubleArray</span><span class="p">)</span> <span class="p">:</span><span class="n">Fit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">assert</span><span class="p">(</span><span class="n">xs</span><span class="p">.</span><span class="n">size</span><span class="o">==</span><span class="n">ys</span><span class="p">.</span><span class="n">size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">x</span> <span class="p">=</span> <span class="n">b</span><span class="p">();</span>  <span class="n">println</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>  <span class="n">println</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">xy</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">mFactory</span><span class="p">.</span><span class="n">column</span><span class="p">(*</span><span class="n">ys</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">g</span> <span class="p">:</span><span class="n">MatrixStore</span><span class="p">&lt;</span><span class="n">Double</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">transpose</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="p">(</span><span class="n">g</span><span class="p">);</span>  <span class="n">println</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">solver</span> <span class="p">=</span> <span class="nc">Cholesky</span><span class="p">.</span><span class="nc">PRIMITIVE</span><span class="p">.</span><span class="n">make</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="py">ok</span> <span class="p">=</span> <span class="n">solver</span><span class="p">.</span><span class="n">checkAndDecompose</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">assert</span><span class="p">(</span><span class="n">ok</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="p">(</span><span class="n">solver</span><span class="p">.</span><span class="n">l</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">assert</span><span class="p">(</span><span class="n">solver</span><span class="p">.</span><span class="n">isSolvable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">Fit</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">solver</span><span class="p">.</span><span class="n">solve</span><span class="p">(</span><span class="n">xy</span><span class="p">).</span><span class="k">get</span><span class="p">().</span><span class="n">transpose</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>D.h. dass wir für die symmetrische Matrix <code>g</code> eine Cholesky-Faktorisierung verwenden.  Deren Berechnung ist numerisch stabiler als der Gaußsche Algorithmus.  Wichtig ist, dass man <code>g</code> zweimal übergeben muss, einmal an <code>.make()</code> und einmal an <code>.checkAndDecompose()</code>.  Beim ersten Aufruf wird lediglich genug Speicher für die Operation initialisiert und die <code>Cholesky</code>-Klasse initialisiert.  Erst beim zweiten Aufruf wird die eigentliche Faktorisierung durchgeführt.  Man beachte auch, dass man nach der Methode <code>.solve(xy)</code> noch ein <code>.get()</code> aufrufen muss, da man sonst nicht das Ergebnis erhält.  Die Regeln für Matrizenmultiplikation verlangen, dass wir die Koeffizienten als Zeilenmatrix verwenden müssen, also noch einmal transponieren müssen.</p>
<p>Schließlich müssen wir auch die beiden Methoden <code>b(...)</code> anpassen, damit die mit den restlichen Methoden zusammen arbeiten:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl">  <span class="k">fun</span> <span class="nf">b</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span><span class="n">Double</span><span class="p">,</span> <span class="n">k</span> <span class="p">:</span><span class="n">UByte</span> <span class="p">=</span><span class="n">deg</span><span class="p">)</span> <span class="p">:</span><span class="n">Primitive64Store</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">indices</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">k</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="m">1</span> <span class="o">-&gt;</span> <span class="m">0</span> <span class="n">until</span> <span class="n">xs</span><span class="p">.</span><span class="n">size</span><span class="p">-</span><span class="m">2</span>
</span></span><span class="line"><span class="cl">        <span class="m">2</span> <span class="o">-&gt;</span> <span class="m">0</span> <span class="n">until</span> <span class="n">xs</span><span class="p">.</span><span class="n">size</span> <span class="p">-</span><span class="m">2</span>
</span></span><span class="line"><span class="cl">        <span class="m">3</span> <span class="o">-&gt;</span> <span class="p">-</span><span class="m">1</span> <span class="n">until</span> <span class="n">xs</span><span class="p">.</span><span class="n">size</span> <span class="p">-</span><span class="m">3</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="o">-&gt;</span> <span class="n">TODO</span><span class="p">(</span><span class="s2">&#34;unimplemented&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">mFactory</span><span class="p">.</span><span class="n">column</span><span class="p">(*(</span><span class="n">listOf</span><span class="p">(</span><span class="n">b</span><span class="p">(-</span><span class="n">k</span><span class="p">.</span><span class="n">toInt</span><span class="p">(),</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="p">+</span>
</span></span><span class="line"><span class="cl">            <span class="n">indices</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">}</span> <span class="p">+</span> <span class="n">listOf</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">xs</span><span class="p">.</span><span class="n">size</span><span class="p">-</span><span class="m">2</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="p">).</span><span class="n">toDoubleArray</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">internal</span> <span class="k">fun</span> <span class="nf">b</span><span class="p">()</span> <span class="p">:</span><span class="n">MatrixStore</span><span class="p">&lt;</span><span class="n">Double</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">cols</span> <span class="p">=</span> <span class="n">xs</span><span class="p">.</span><span class="n">slice</span><span class="p">(</span><span class="m">0</span> <span class="n">until</span> <span class="n">xs</span><span class="p">.</span><span class="n">size</span><span class="p">-</span><span class="m">1</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">b</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span> <span class="p">+</span>
</span></span><span class="line"><span class="cl">            <span class="n">listOf</span><span class="p">(</span><span class="n">mFactory</span><span class="p">.</span><span class="n">column</span><span class="p">(*(</span><span class="n">Array</span><span class="p">(</span><span class="n">xs</span><span class="p">.</span><span class="n">size</span><span class="p">-</span><span class="m">1</span><span class="p">)</span> <span class="p">{</span> <span class="m">0.0</span> <span class="p">}.</span><span class="n">toList</span><span class="p">()</span> <span class="p">+</span> <span class="n">listOf</span><span class="p">(</span><span class="m">1.0</span><span class="p">)).</span><span class="n">toDoubleArray</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">mFactory</span><span class="p">.</span><span class="n">columns</span><span class="p">(*</span><span class="n">cols</span><span class="p">.</span><span class="n">toTypedArray</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Konkret heißt die obige Definition von <code>fun b(x :Double, ...)</code>, dass wir nur mit Splines vom Grad 1, 2 oder 3 arbeiten können, aber das sind die häufigsten Grade.  In den obigen Beispielen hatten wir ja stets Grad 3 verwendet.</p>
<p>Viel Erfolg beim Probieren.</p>
<h2 id="99-zusammenfassung">9.9 Zusammenfassung</h2>
<p>Inzwischen hast du vielleicht festgestellt, dass die Programme länger werden und mehr probiert werden muss, bevor etwas schön funktioniert.  Das ist die Realität beim Programmieren.  Am obigen Beispiel habe ich ca. 2 Wochen gefeilt, bis es halbwegs funktioniert hat.  Zum Nachprogrammieren (anhand der Hinweise im Text) brauchst du vielleicht 1&ndash;3 Wochenenden.  Sei also nicht verzagt, wenn es nicht an 1 Wochenende klappt.</p>
<p>Prinzipiell gilt für Projekte, dass man sich überlegen sollte, was das langfristige Ziel ist, welche prinzipiellen Schritte man dafür braucht, welches zusätzliche Wissen/ welche Literatur und in welchen Etappen / mit welchen Zwischenerfolgen man vorgehen möchte.  Es empfiehlt sich, einfache erste Zwischenziele zu setzen (und diese dann langsam zu steigern), damit man den Mut nicht verliert.  Auch wenn man ein Projekt nicht (gleich) bis zum Abschluss bringt, lernt man beim Durchführen solcher Projekte oft viel mehr, als wenn man nur beliebige Texte über das Programmieren lesen würde.</p>
<p>Für diejenigen, die als Oberschüler bereits mit Projekten zurechtkommen, gibt es <a href="https://www.jugend-forscht.de/">Jugend Forscht</a>, bei dem man abgesteckte kleine Projekte selbst durchführen kann, zum Beispiel in Mathematik, Informatik oder anderen Natur- und Ingenieurwissenschaftlichen Gebieten.  Motivierender ist es auch, wenn man ein Projekt mit 1 oder 2 interessierten Freunden gemeinsam durchführt und sich gegenseitig regelmäßig motiviert, weiter zu kommen und  die Zwischenergebnisse anzusehen.</p>
<h1 id="weiterführende-literatur">Weiterführende Literatur</h1>
<p>[1] <a href="https://de.wikipedia.org/wiki/B%C3%A9zierkurve">wiki: Bézierkurven</a></p>
<p>[2] L.L. Schumaker: <em>Spline Functions, Basic Theory</em>, <strong>1981</strong>.</p>
<p>[3] S. Zhou and X. Shen: <em>Spatially Adaptive Regression Splines and Accurate Knot Selection Schemes</em>, <strong>2021</strong>.</p>
<p>[4] <a href="https://www.ojalgo.org/">https://www.ojalgo.org/</a></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">melli79</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2023-02-20
        
    </span>
  </p>
  <p class="copyright-item">
      <span class="item-title">Markdown</span>
      <span class="item-content"><a class="link-to-markdown" href="https://melli79.github.io/post/30beziercurves/index.md" target="_blank">The Markdown version »</a></span>
    </p>
  
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        
        <a class="next" href="/post/24errorcorrection/">
            <span class="next-text nav-default">24. Störungssichere Übertragung</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="comments-gitment"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/default.min.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/gitment.browser.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var gitment = new Gitment({
        id: '2023-02-20 18:12:00 \u002b0100 CET',
        title: '30. Projekt Bézierkurven',
        link: decodeURI(location.href),
        desc: 'Nachdem wir in den ersten 3 Teilen eine Einführung in Kotlin und Programmieren, sowie Grafikprogrammierung und vertiefende Algorithmen betrachtet haben, wollen uns jetzt mittelgroßen Projekten widmen. Heute fangen wir mit Bézierkurven an.\n0. Die Aufgabe Gegeben ein paar Punkte in der Ebene, wie können wir eine glatte Kurve durch diese Punkte zeichnen?\nBild 1: Straklatte (engl. spline) durch 4 Punkte. CC P.S. Foresman 2007.\nWenn wir das mechanisch tun wollen, dann könnten wir die benachbarten Punkte mit einem Lineal (und Stift) verbinden.',
        owner: 'melli79',
        repo: '',
        oauth: {
          client_id: '',
          client_secret: ''
        }
      });
      gitment.render('comments-gitment');
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/imsun/gitment">comments powered by gitment.</a></noscript>

  

  
    <script src="https://utteranc.es/client.js"
            repo="melli79/"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:melchiorG@gMail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://www.linkedin.com/in/melchior-grutzmann-01741510/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="http://github.com/melli79/" class="iconfont icon-github" title="github"></a>
      <a href="https://www.instagram.com/gulinculture/" class="iconfont icon-instagram" title="instagram"></a>
  <a href="https://melli79.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2020 - 
    2023
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">melli79</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.1c70606d1b733282f06230615f5561b5894924b6f9930ba2ab99cf1254f75a1a.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








</body>
</html>
